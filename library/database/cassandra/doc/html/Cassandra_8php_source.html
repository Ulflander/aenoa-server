<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Cassandra PHP Client Library: Cassandra.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Cassandra PHP Client Library</div>
   <div id="projectbrief">Cassandra PHP-based client library for managing and querying your Cassandra cluster.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>Cassandra.php</h1>  </div>
</div>
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00036"></a>00036 <span class="comment">// set the globals that the thrift library uses</span>
<a name="l00037"></a>00037 $GLOBALS[<span class="stringliteral">&#39;THRIFT_ROOT&#39;</span>] = dirname(__FILE__) . <span class="stringliteral">&#39;/thrift/&#39;</span>;
<a name="l00038"></a>00038 define(<span class="stringliteral">&#39;THRIFT_PATH&#39;</span>, $GLOBALS[<span class="stringliteral">&#39;THRIFT_ROOT&#39;</span>]);
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="comment">// require thrift packages</span>
<a name="l00041"></a>00041 require_once $GLOBALS[<span class="stringliteral">&#39;THRIFT_ROOT&#39;</span>].<span class="stringliteral">&#39;/packages/cassandra/Cassandra.php&#39;</span>;
<a name="l00042"></a>00042 require_once $GLOBALS[<span class="stringliteral">&#39;THRIFT_ROOT&#39;</span>].<span class="stringliteral">&#39;/transport/TSocket.php&#39;</span>;
<a name="l00043"></a>00043 require_once $GLOBALS[<span class="stringliteral">&#39;THRIFT_ROOT&#39;</span>].<span class="stringliteral">&#39;/protocol/TBinaryProtocol.php&#39;</span>;
<a name="l00044"></a>00044 
<a name="l00050"></a><a class="code" href="classCassandraConnection.html">00050</a> <span class="keyword">class </span><a class="code" href="classCassandraConnection.html">CassandraConnection</a> {
<a name="l00051"></a>00051     
<a name="l00057"></a>00057     <span class="keyword">protected</span> $host;
<a name="l00058"></a>00058     
<a name="l00064"></a>00064     <span class="keyword">protected</span> $port;
<a name="l00065"></a>00065     
<a name="l00071"></a>00071     <span class="keyword">protected</span> $useFramedTransport;
<a name="l00072"></a>00072     
<a name="l00078"></a>00078     <span class="keyword">protected</span> $sendTimeoutMs;
<a name="l00079"></a>00079     
<a name="l00085"></a>00085     <span class="keyword">protected</span> $receiveTimeoutMs;
<a name="l00086"></a>00086     
<a name="l00092"></a>00092     <span class="keyword">protected</span> $socket;
<a name="l00093"></a>00093     
<a name="l00099"></a>00099     <span class="keyword">protected</span> $transport;
<a name="l00100"></a>00100     
<a name="l00106"></a>00106     <span class="keyword">protected</span> $protocol;
<a name="l00107"></a>00107     
<a name="l00113"></a>00113     <span class="keyword">protected</span> $client;
<a name="l00114"></a>00114     
<a name="l00120"></a>00120     <span class="keyword">protected</span> $isOpen;
<a name="l00121"></a>00121     
<a name="l00131"></a><a class="code" href="classCassandraConnection.html#a7f75a298bf9fb6362d38f4aeb42ceb28">00131</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#a7f75a298bf9fb6362d38f4aeb42ceb28">__construct</a>(
<a name="l00132"></a>00132         $host = <span class="stringliteral">&#39;127.0.0.1&#39;</span>,
<a name="l00133"></a>00133         $port = 9160,
<a name="l00134"></a>00134         $useFramedTransport = <span class="keyword">true</span>,
<a name="l00135"></a>00135         $sendTimeoutMs = null,
<a name="l00136"></a>00136         $receiveTimeoutMs = null
<a name="l00137"></a>00137     ) {
<a name="l00138"></a>00138         $this-&gt;host = $host;
<a name="l00139"></a>00139         $this-&gt;port = $port;
<a name="l00140"></a>00140         $this-&gt;useFramedTransport = $useFramedTransport;
<a name="l00141"></a>00141         $this-&gt;sendTimeoutMs = $sendTimeoutMs;
<a name="l00142"></a>00142         $this-&gt;receiveTimeoutMs = $receiveTimeoutMs;
<a name="l00143"></a>00143         $this-&gt;<a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">isOpen</a> = <span class="keyword">false</span>;
<a name="l00144"></a>00144         
<a name="l00145"></a>00145         $this-&gt;socket = $this-&gt;<a class="code" href="classCassandraConnection.html#a6886c992c6b7cbc24deb801fb8ee52db">createSocket</a>(
<a name="l00146"></a>00146             $host,
<a name="l00147"></a>00147             $port,
<a name="l00148"></a>00148             $sendTimeoutMs,
<a name="l00149"></a>00149             $receiveTimeoutMs
<a name="l00150"></a>00150         );
<a name="l00151"></a>00151         
<a name="l00152"></a>00152         <span class="keywordflow">if</span> ($useFramedTransport) {
<a name="l00153"></a>00153             $this-&gt;transport = $this-&gt;<a class="code" href="classCassandraConnection.html#a00c2d10e54028d15cfb5ef8bde3468d3">createFramedTransport</a>($this-&gt;socket);
<a name="l00154"></a>00154         } <span class="keywordflow">else</span> {
<a name="l00155"></a>00155             $this-&gt;transport = $this-&gt;<a class="code" href="classCassandraConnection.html#a3e3b2e2318ff07ee56bcae235634c2e4">createBufferedTransport</a>($this-&gt;socket);
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157         
<a name="l00158"></a>00158         $this-&gt;transport-&gt;open();
<a name="l00159"></a>00159         $this-&gt;<a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">isOpen</a> = <span class="keyword">true</span>;
<a name="l00160"></a>00160         
<a name="l00161"></a>00161         $this-&gt;protocol = <span class="keyword">new</span> TBinaryProtocolAccelerated($this-&gt;transport);
<a name="l00162"></a>00162         $this-&gt;client = <span class="keyword">new</span> CassandraClient($this-&gt;protocol);
<a name="l00163"></a>00163     }
<a name="l00164"></a>00164     
<a name="l00168"></a><a class="code" href="classCassandraConnection.html#ab491ef3fe8550d70856e708e528cb570">00168</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#ab491ef3fe8550d70856e708e528cb570">__destruct</a>() {
<a name="l00169"></a>00169         $this-&gt;<a class="code" href="classCassandraConnection.html#abd8bbd3ef94126f1e6a274b5ad512ece">close</a>();
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171     
<a name="l00178"></a><a class="code" href="classCassandraConnection.html#abd8bbd3ef94126f1e6a274b5ad512ece">00178</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#abd8bbd3ef94126f1e6a274b5ad512ece">close</a>() {
<a name="l00179"></a>00179         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">isOpen</a>) {
<a name="l00180"></a>00180             $this-&gt;transport-&gt;flush();
<a name="l00181"></a>00181             $this-&gt;transport-&gt;close();
<a name="l00182"></a>00182             
<a name="l00183"></a>00183             $this-&gt;<a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">isOpen</a> = <span class="keyword">false</span>;
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186     
<a name="l00192"></a><a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">00192</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">isOpen</a>() {
<a name="l00193"></a>00193         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">isOpen</a>;
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195     
<a name="l00201"></a><a class="code" href="classCassandraConnection.html#a9333243e248f73414e25d5fe143250df">00201</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#a9333243e248f73414e25d5fe143250df">getClient</a>() {
<a name="l00202"></a>00202         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="classCassandraConnection.html#aed004bd39c88a8aea40292f9c5271512">isOpen</a>) {
<a name="l00203"></a>00203             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraConnectionClosedException.html">CassandraConnectionClosedException</a>(
<a name="l00204"></a>00204                 <span class="stringliteral">&#39;The connection has been closed&#39;</span>
<a name="l00205"></a>00205             );
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207         
<a name="l00208"></a>00208         <span class="keywordflow">return</span> $this-&gt;client;
<a name="l00209"></a>00209     }
<a name="l00210"></a>00210     
<a name="l00216"></a><a class="code" href="classCassandraConnection.html#a7f12a9a108ea4d89083a48bbebdb8a60">00216</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#a7f12a9a108ea4d89083a48bbebdb8a60">getTransport</a>() {
<a name="l00217"></a>00217         <span class="keywordflow">return</span> $this-&gt;transport;
<a name="l00218"></a>00218     }
<a name="l00219"></a>00219     
<a name="l00225"></a><a class="code" href="classCassandraConnection.html#adb1d52d166f36506ab94605b260e821f">00225</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#adb1d52d166f36506ab94605b260e821f">getProtocol</a>() {
<a name="l00226"></a>00226         <span class="keywordflow">return</span> $this-&gt;transport;
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228     
<a name="l00238"></a><a class="code" href="classCassandraConnection.html#a9bb32ec133d74c18a5ab142a33b96539">00238</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraConnection.html#a9bb32ec133d74c18a5ab142a33b96539">useKeyspace</a>(
<a name="l00239"></a>00239         $keyspace,
<a name="l00240"></a>00240         $username = null,
<a name="l00241"></a>00241         $password = null
<a name="l00242"></a>00242     ) {
<a name="l00243"></a>00243         $attempts = 3;
<a name="l00244"></a>00244         $success = <span class="keyword">false</span>;
<a name="l00245"></a>00245 
<a name="l00246"></a>00246         <span class="keywordflow">while</span>($attempts-- &gt; 0 &amp;&amp; !$success) {
<a name="l00247"></a>00247             <span class="keywordflow">try</span> {
<a name="l00248"></a>00248                 $this-&gt;client-&gt;set_keyspace($keyspace);
<a name="l00249"></a>00249                 $success = <span class="keyword">true</span>;
<a name="l00250"></a>00250             } <span class="keywordflow">catch</span> (cassandra_InvalidRequestException $e) {
<a name="l00251"></a>00251                 <span class="keywordflow">continue</span>;
<a name="l00252"></a>00252             }
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254         
<a name="l00255"></a>00255         <span class="keywordflow">if</span> (!$success) {
<a name="l00256"></a>00256             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraSettingKeyspaceFailedException.html">CassandraSettingKeyspaceFailedException</a>(
<a name="l00257"></a>00257                 <span class="stringliteral">&#39;Using keyspace &quot;&#39;</span>.$keyspace.<span class="stringliteral">&#39;&quot; failed after several attempts&#39;</span>
<a name="l00258"></a>00258             );
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260         
<a name="l00261"></a>00261         <span class="keywordflow">if</span> ($username !== null) {
<a name="l00262"></a>00262             $request = <span class="keyword">new</span> cassandra_AuthenticationRequest(
<a name="l00263"></a>00263                 array(<span class="stringliteral">&#39;credentials&#39;</span> =&gt; array($username, $password))
<a name="l00264"></a>00264             );
<a name="l00265"></a>00265 
<a name="l00266"></a>00266             $this-&gt;client-&gt;login($request);
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269     
<a name="l00279"></a><a class="code" href="classCassandraConnection.html#a6886c992c6b7cbc24deb801fb8ee52db">00279</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandraConnection.html#a6886c992c6b7cbc24deb801fb8ee52db">createSocket</a>(
<a name="l00280"></a>00280         $host,
<a name="l00281"></a>00281         $port,
<a name="l00282"></a>00282         $sendTimeoutMs,
<a name="l00283"></a>00283         $receiveTimeoutMs
<a name="l00284"></a>00284     ) {
<a name="l00285"></a>00285         $socket = <span class="keyword">new</span> TSocket($host, $port);
<a name="l00286"></a>00286         
<a name="l00287"></a>00287         <span class="keywordflow">if</span> ($sendTimeoutMs !== null) {
<a name="l00288"></a>00288             $socket-&gt;setSendTimeout($sendTimeoutMs);
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         
<a name="l00291"></a>00291         <span class="keywordflow">if</span> ($receiveTimeoutMs !== null) {
<a name="l00292"></a>00292             $socket-&gt;setRecvTimeout($receiveTimeoutMs);
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294         
<a name="l00295"></a>00295         <span class="keywordflow">return</span> $socket;
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     
<a name="l00304"></a><a class="code" href="classCassandraConnection.html#a00c2d10e54028d15cfb5ef8bde3468d3">00304</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandraConnection.html#a00c2d10e54028d15cfb5ef8bde3468d3">createFramedTransport</a>(TSocket $socket) {
<a name="l00305"></a>00305         require_once THRIFT_PATH.<span class="stringliteral">&#39;/transport/TFramedTransport.php&#39;</span>;
<a name="l00306"></a>00306             
<a name="l00307"></a>00307         <span class="keywordflow">return</span> <span class="keyword">new</span> TFramedTransport($socket, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00308"></a>00308     }
<a name="l00309"></a>00309     
<a name="l00316"></a><a class="code" href="classCassandraConnection.html#a3e3b2e2318ff07ee56bcae235634c2e4">00316</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandraConnection.html#a3e3b2e2318ff07ee56bcae235634c2e4">createBufferedTransport</a>(TSocket $socket) {
<a name="l00317"></a>00317         require_once THRIFT_PATH.<span class="stringliteral">&#39;/transport/TBufferedTransport.php&#39;</span>;
<a name="l00318"></a>00318             
<a name="l00319"></a>00319         <span class="keywordflow">return</span> <span class="keyword">new</span> TBufferedTransport($socket, 512, 512);
<a name="l00320"></a>00320     }
<a name="l00321"></a>00321 }
<a name="l00322"></a>00322 
<a name="l00328"></a><a class="code" href="classCassandraCluster.html">00328</a> <span class="keyword">class </span><a class="code" href="classCassandraCluster.html">CassandraCluster</a> {
<a name="l00329"></a>00329     
<a name="l00335"></a>00335     <span class="keyword">protected</span> $keyspace;
<a name="l00336"></a>00336     
<a name="l00342"></a>00342     <span class="keyword">protected</span> $username;
<a name="l00343"></a>00343     
<a name="l00349"></a>00349     <span class="keyword">protected</span> $password;
<a name="l00350"></a>00350     
<a name="l00356"></a>00356     <span class="keyword">protected</span> $servers = array();
<a name="l00357"></a>00357     
<a name="l00365"></a>00365     <span class="keyword">protected</span> $connections = array();
<a name="l00366"></a>00366     
<a name="l00375"></a><a class="code" href="classCassandraCluster.html#a6ca88a787d742b39e43b6a5fefabc633">00375</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#a6ca88a787d742b39e43b6a5fefabc633">__construct</a>(array $servers = array()) {
<a name="l00376"></a>00376         <span class="keywordflow">foreach</span> ($servers as $server) {
<a name="l00377"></a>00377             $this-&gt;<a class="code" href="classCassandraCluster.html#a49baa9fac921644a5ba10f98c4a7412d">registerServer</a>(
<a name="l00378"></a>00378                 isset($server[<span class="stringliteral">&#39;host&#39;</span>]) ? $server[<span class="stringliteral">&#39;host&#39;</span>] : <span class="stringliteral">&#39;127.0.0.1&#39;</span>,
<a name="l00379"></a>00379                 isset($server[<span class="stringliteral">&#39;port&#39;</span>]) ? $server[<span class="stringliteral">&#39;port&#39;</span>] : 9160,
<a name="l00380"></a>00380                 isset($server[<span class="stringliteral">&#39;use-framed-transport&#39;</span>]) ? $server[<span class="stringliteral">&#39;use-framed-transport&#39;</span>] : <span class="keyword">true</span>,
<a name="l00381"></a>00381                 isset($server[<span class="stringliteral">&#39;send-timeout-ms&#39;</span>]) ? $server[<span class="stringliteral">&#39;send-timeout-ms&#39;</span>] : null,
<a name="l00382"></a>00382                 isset($server[<span class="stringliteral">&#39;receive-timeout-ms&#39;</span>]) ? $server[<span class="stringliteral">&#39;receive-timeout-ms&#39;</span>] : null
<a name="l00383"></a>00383             );
<a name="l00384"></a>00384         }
<a name="l00385"></a>00385     }
<a name="l00386"></a>00386     
<a name="l00390"></a><a class="code" href="classCassandraCluster.html#a4ce9e28f647bbbbb253273c3e0fa377a">00390</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#a4ce9e28f647bbbbb253273c3e0fa377a">__destruct</a>() {
<a name="l00391"></a>00391         $this-&gt;<a class="code" href="classCassandraCluster.html#afbff3180c5d4bb74c8b230436349d460">closeConnections</a>();
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     
<a name="l00407"></a><a class="code" href="classCassandraCluster.html#a49baa9fac921644a5ba10f98c4a7412d">00407</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#a49baa9fac921644a5ba10f98c4a7412d">registerServer</a>(
<a name="l00408"></a>00408         $host = <span class="stringliteral">&#39;127.0.0.1&#39;</span>,
<a name="l00409"></a>00409         $port = 9160,
<a name="l00410"></a>00410         $useFramedTransport = <span class="keyword">true</span>,
<a name="l00411"></a>00411         $sendTimeoutMs = null,
<a name="l00412"></a>00412         $receiveTimeoutMs = null
<a name="l00413"></a>00413     ) {
<a name="l00414"></a>00414         $this-&gt;servers[] = array(
<a name="l00415"></a>00415             <span class="stringliteral">&#39;host&#39;</span> =&gt; $host,
<a name="l00416"></a>00416             <span class="stringliteral">&#39;port&#39;</span> =&gt; $port,
<a name="l00417"></a>00417             <span class="stringliteral">&#39;use-framed-transport&#39;</span> =&gt; $useFramedTransport,
<a name="l00418"></a>00418             <span class="stringliteral">&#39;send-timeout-ms&#39;</span> =&gt; $sendTimeoutMs,
<a name="l00419"></a>00419             <span class="stringliteral">&#39;receive-timeout-ms&#39;</span> =&gt; $receiveTimeoutMs
<a name="l00420"></a>00420         );
<a name="l00421"></a>00421         
<a name="l00422"></a>00422         <span class="keywordflow">return</span> $this;
<a name="l00423"></a>00423     }
<a name="l00424"></a>00424     
<a name="l00433"></a><a class="code" href="classCassandraCluster.html#a1044f6f79a82fbb33aa6dd0374cac07a">00433</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#a1044f6f79a82fbb33aa6dd0374cac07a">useKeyspace</a>($keyspace, $username = null, $password = null) {
<a name="l00434"></a>00434         $this-&gt;keyspace = $keyspace;
<a name="l00435"></a>00435         $this-&gt;username = $username;
<a name="l00436"></a>00436         $this-&gt;password = $password;
<a name="l00437"></a>00437         
<a name="l00438"></a>00438         $this-&gt;<a class="code" href="classCassandraCluster.html#a27ec1b4718ca21a87a791035130d0746">getConnection</a>();
<a name="l00439"></a>00439 
<a name="l00440"></a>00440         <span class="keywordflow">foreach</span> ($this-&gt;connections as $connection) {
<a name="l00441"></a>00441             $connection-&gt;useKeyspace(
<a name="l00442"></a>00442                 $keyspace,
<a name="l00443"></a>00443                 $username,
<a name="l00444"></a>00444                 $password
<a name="l00445"></a>00445             );
<a name="l00446"></a>00446         }
<a name="l00447"></a>00447         
<a name="l00448"></a>00448         <span class="keywordflow">return</span> $this;
<a name="l00449"></a>00449     }
<a name="l00450"></a>00450     
<a name="l00456"></a><a class="code" href="classCassandraCluster.html#a0cc3add750920cad51b03676b549e256">00456</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#a0cc3add750920cad51b03676b549e256">getCurrentKeyspace</a>() {
<a name="l00457"></a>00457         <span class="keywordflow">return</span> $this-&gt;keyspace;
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459     
<a name="l00465"></a><a class="code" href="classCassandraCluster.html#af213845fa6bfb0e6a986fb671be28552">00465</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#af213845fa6bfb0e6a986fb671be28552">getServers</a>() {
<a name="l00466"></a>00466         <span class="keywordflow">return</span> $this-&gt;servers;
<a name="l00467"></a>00467     }
<a name="l00468"></a>00468     
<a name="l00484"></a><a class="code" href="classCassandraCluster.html#a27ec1b4718ca21a87a791035130d0746">00484</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#a27ec1b4718ca21a87a791035130d0746">getConnection</a>() {
<a name="l00485"></a>00485         <span class="keywordflow">if</span> (empty($this-&gt;servers)) {
<a name="l00486"></a>00486             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraConnectionFailedException.html">CassandraConnectionFailedException</a>(
<a name="l00487"></a>00487                 <span class="stringliteral">&#39;Unable to create connection, the cluster server pool is empty&#39;</span>
<a name="l00488"></a>00488             );
<a name="l00489"></a>00489         }
<a name="l00490"></a>00490             
<a name="l00491"></a>00491         $serverCount = count($this-&gt;servers);
<a name="l00492"></a>00492         $attemptsLeft = $serverCount * 2;
<a name="l00493"></a>00493         
<a name="l00494"></a>00494         <span class="keywordflow">while</span> ($attemptsLeft-- &gt; 0) {
<a name="l00495"></a>00495             $randomServerIndex = mt_rand(0, $serverCount - 1);
<a name="l00496"></a>00496             
<a name="l00497"></a>00497             <span class="keywordflow">if</span> (isset($this-&gt;connections[$randomServerIndex])) {
<a name="l00498"></a>00498                 <span class="keywordflow">if</span> (!$this-&gt;connections[$randomServerIndex]-&gt;isOpen()) {
<a name="l00499"></a>00499                     unset($this-&gt;connections[$randomServerIndex]);
<a name="l00500"></a>00500                     
<a name="l00501"></a>00501                     <span class="keywordflow">continue</span>;
<a name="l00502"></a>00502                 }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504                 <span class="keywordflow">return</span> $this-&gt;connections[$randomServerIndex];
<a name="l00505"></a>00505             } <span class="keywordflow">else</span> {
<a name="l00506"></a>00506                 $server = $this-&gt;servers[$randomServerIndex];
<a name="l00507"></a>00507                 
<a name="l00508"></a>00508                 <span class="keywordflow">try</span> {
<a name="l00509"></a>00509                     $this-&gt;connections[$randomServerIndex] = <span class="keyword">new</span> <a class="code" href="classCassandraConnection.html">CassandraConnection</a>(
<a name="l00510"></a>00510                         $server[<span class="stringliteral">&#39;host&#39;</span>],
<a name="l00511"></a>00511                         $server[<span class="stringliteral">&#39;port&#39;</span>],
<a name="l00512"></a>00512                         $server[<span class="stringliteral">&#39;use-framed-transport&#39;</span>],
<a name="l00513"></a>00513                         $server[<span class="stringliteral">&#39;send-timeout-ms&#39;</span>],
<a name="l00514"></a>00514                         $server[<span class="stringliteral">&#39;receive-timeout-ms&#39;</span>]
<a name="l00515"></a>00515                     );
<a name="l00516"></a>00516                     
<a name="l00517"></a>00517                     $this-&gt;connections[$randomServerIndex]-&gt;useKeyspace(
<a name="l00518"></a>00518                         $this-&gt;keyspace,
<a name="l00519"></a>00519                         $this-&gt;username,
<a name="l00520"></a>00520                         $this-&gt;password
<a name="l00521"></a>00521                     );
<a name="l00522"></a>00522                     
<a name="l00523"></a>00523                     <span class="keywordflow">return</span> $this-&gt;connections[$randomServerIndex];
<a name="l00524"></a>00524                 } <span class="keywordflow">catch</span> (TException $e) {
<a name="l00525"></a>00525                     <span class="keywordflow">continue</span>;
<a name="l00526"></a>00526                 }
<a name="l00527"></a>00527             }
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529         
<a name="l00530"></a>00530         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraConnectionFailedException.html">CassandraConnectionFailedException</a>(
<a name="l00531"></a>00531             <span class="stringliteral">&#39;Connecting to any of the &#39;</span>.$serverCount.<span class="stringliteral">&#39; nodes failed&#39;</span>
<a name="l00532"></a>00532         );
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534     
<a name="l00540"></a><a class="code" href="classCassandraCluster.html#afbff3180c5d4bb74c8b230436349d460">00540</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraCluster.html#afbff3180c5d4bb74c8b230436349d460">closeConnections</a>() {
<a name="l00541"></a>00541         <span class="keywordflow">foreach</span> ($this-&gt;connections as $connection) {
<a name="l00542"></a>00542             $connection-&gt;close();
<a name="l00543"></a>00543         }
<a name="l00544"></a>00544         
<a name="l00545"></a>00545         $this-&gt;connections = array();
<a name="l00546"></a>00546         
<a name="l00547"></a>00547         <span class="keywordflow">return</span> $this;
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549 }
<a name="l00550"></a>00550 
<a name="l00555"></a><a class="code" href="classCassandra.html">00555</a> <span class="keyword">class </span><a class="code" href="classCassandra.html">Cassandra</a> {
<a name="l00556"></a>00556     
<a name="l00562"></a>00562     <span class="keyword">protected</span> <span class="keyword">static</span> $instances = array();
<a name="l00563"></a>00563     
<a name="l00570"></a>00570     <span class="keyword">protected</span> <span class="keyword">static</span> $keyspaceRequiredMethods;
<a name="l00571"></a>00571     
<a name="l00577"></a>00577     <span class="keyword">protected</span> <span class="keyword">static</span> $requestKeyTokens = array(<span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;:&#39;</span>, <span class="charliteral">&#39;,&#39;</span>, <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;|&#39;</span>);
<a name="l00578"></a>00578     
<a name="l00584"></a>00584     <span class="keyword">protected</span> $cluster;
<a name="l00585"></a>00585     
<a name="l00593"></a>00593     <span class="keyword">protected</span> $maxCallRetries = 5;
<a name="l00594"></a>00594     
<a name="l00600"></a>00600     <span class="keyword">protected</span> $defaultColumnCount = 100;
<a name="l00601"></a>00601     
<a name="l00610"></a>00610     <span class="keyword">protected</span> $columnFamilies = array();
<a name="l00611"></a>00611     
<a name="l00617"></a>00617     <span class="keyword">protected</span> $keyspaceAuthentication = array();
<a name="l00618"></a>00618     
<a name="l00625"></a>00625     <span class="keyword">protected</span> $autopack = <span class="keyword">true</span>;
<a name="l00626"></a>00626     
<a name="l00634"></a><a class="code" href="classCassandra.html#afd35e5b7419ce2915891c349a44b6f22">00634</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#afd35e5b7419ce2915891c349a44b6f22">CONSISTENCY_ONE</a> = cassandra_ConsistencyLevel::ONE;
<a name="l00635"></a>00635     
<a name="l00644"></a><a class="code" href="classCassandra.html#a58c08b49c2434526a62f74248c8b959d">00644</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a58c08b49c2434526a62f74248c8b959d">CONSISTENCY_QUORUM</a> = cassandra_ConsistencyLevel::QUORUM;
<a name="l00645"></a>00645     
<a name="l00657"></a><a class="code" href="classCassandra.html#a94fdd09de0798393d86a9965482cefa7">00657</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a94fdd09de0798393d86a9965482cefa7">CONSISTENCY_ANY</a> = cassandra_ConsistencyLevel::ANY;
<a name="l00658"></a>00658     
<a name="l00667"></a><a class="code" href="classCassandra.html#ac7e4763d615ce200970153894d53219a">00667</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#ac7e4763d615ce200970153894d53219a">CONSISTENCY_ALL</a> = cassandra_ConsistencyLevel::ALL;
<a name="l00668"></a>00668     
<a name="l00672"></a><a class="code" href="classCassandra.html#a5b7fd78b8f044623445d9e9a8f175790">00672</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a5b7fd78b8f044623445d9e9a8f175790">COLUMN_STANDARD</a> = <span class="stringliteral">&#39;Standard&#39;</span>;
<a name="l00673"></a>00673     
<a name="l00677"></a><a class="code" href="classCassandra.html#abf8e49b590d1e1b83d3e13cc133cd672">00677</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#abf8e49b590d1e1b83d3e13cc133cd672">COLUMN_SUPER</a> = <span class="stringliteral">&#39;Super&#39;</span>;
<a name="l00678"></a>00678     
<a name="l00682"></a><a class="code" href="classCassandra.html#acc917786b5bbbdd6eb4783856bd5580c">00682</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#acc917786b5bbbdd6eb4783856bd5580c">TYPE_ASCII</a> = <span class="stringliteral">&#39;AsciiType&#39;</span>;
<a name="l00683"></a>00683     
<a name="l00687"></a><a class="code" href="classCassandra.html#ab75de9aa0588c7665f1c9d8cf8d4e8ff">00687</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#ab75de9aa0588c7665f1c9d8cf8d4e8ff">TYPE_BYTES</a> = <span class="stringliteral">&#39;BytesType&#39;</span>;
<a name="l00688"></a>00688     
<a name="l00697"></a><a class="code" href="classCassandra.html#a2af16bdea44f4e16ba5c5baa5380b9f0">00697</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a2af16bdea44f4e16ba5c5baa5380b9f0">TYPE_LEXICAL_UUID</a> = <span class="stringliteral">&#39;LexicalUUIDType&#39;</span>;
<a name="l00698"></a>00698     
<a name="l00706"></a><a class="code" href="classCassandra.html#a42861ad94788ba940228767a79f1c4c7">00706</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a42861ad94788ba940228767a79f1c4c7">TYPE_TIME_UUID</a> = <span class="stringliteral">&#39;TimeUUIDType&#39;</span>;
<a name="l00707"></a>00707     
<a name="l00711"></a><a class="code" href="classCassandra.html#acf64f8105c4bfe0c95f868437299442f">00711</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#acf64f8105c4bfe0c95f868437299442f">TYPE_LONG</a> = <span class="stringliteral">&#39;LongType&#39;</span>;
<a name="l00712"></a>00712     
<a name="l00716"></a><a class="code" href="classCassandra.html#a4160c654a18aead3a642fd1f3f2415e9">00716</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a4160c654a18aead3a642fd1f3f2415e9">TYPE_INTEGER</a> = <span class="stringliteral">&#39;IntegerType&#39;</span>;
<a name="l00717"></a>00717     
<a name="l00721"></a><a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">00721</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">TYPE_UTF8</a> = <span class="stringliteral">&#39;UTF8Type&#39;</span>;
<a name="l00722"></a>00722     
<a name="l00726"></a><a class="code" href="classCassandra.html#a33b81650dd46405f23e6d469eeb1bd5b">00726</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a33b81650dd46405f23e6d469eeb1bd5b">OP_EQ</a> = cassandra_IndexOperator::EQ;
<a name="l00727"></a>00727     
<a name="l00731"></a><a class="code" href="classCassandra.html#acf59b31536a8a886422ef7335020f99d">00731</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#acf59b31536a8a886422ef7335020f99d">OP_LT</a> = cassandra_IndexOperator::LT;
<a name="l00732"></a>00732     
<a name="l00736"></a><a class="code" href="classCassandra.html#a660ca00d7f33558017e15ccc1f8f5d29">00736</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a660ca00d7f33558017e15ccc1f8f5d29">OP_GT</a> = cassandra_IndexOperator::GT;
<a name="l00737"></a>00737     
<a name="l00741"></a><a class="code" href="classCassandra.html#ab633158313b4f7f785910884d950f945">00741</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#ab633158313b4f7f785910884d950f945">OP_LTE</a> = cassandra_IndexOperator::LTE;
<a name="l00742"></a>00742     
<a name="l00746"></a><a class="code" href="classCassandra.html#a60a245248555c96cadec6977014c27df">00746</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a60a245248555c96cadec6977014c27df">OP_GTE</a> = cassandra_IndexOperator::GTE;
<a name="l00747"></a>00747     
<a name="l00752"></a><a class="code" href="classCassandra.html#acae99f4717a1b6a2fb14343b9ca02806">00752</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#acae99f4717a1b6a2fb14343b9ca02806">PLACEMENT_SIMPLE</a> = <span class="stringliteral">&#39;org.apache.cassandra.locator.SimpleStrategy&#39;</span>;
<a name="l00753"></a>00753     
<a name="l00757"></a>00757     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a82e1fae7c469b0983ad1d38b309273fd">PLACEMENT_NETWORK</a>
<a name="l00758"></a><a class="code" href="classCassandra.html#a82e1fae7c469b0983ad1d38b309273fd">00758</a>         = <span class="stringliteral">&#39;org.apache.cassandra.locator.NetworkTopologyStrategy&#39;</span>;
<a name="l00759"></a>00759     
<a name="l00763"></a>00763     <span class="keyword">const</span> <a class="code" href="classCassandra.html#a3ea159c9a7ead7fa56cac7f8ebe9bc74">PLACEMENT_OLD_NETWORK</a>
<a name="l00764"></a><a class="code" href="classCassandra.html#a3ea159c9a7ead7fa56cac7f8ebe9bc74">00764</a>         = <span class="stringliteral">&#39;org.apache.cassandra.locator.OldNetworkTopologyStrategy&#39;</span>;
<a name="l00765"></a>00765     
<a name="l00769"></a><a class="code" href="classCassandra.html#aa3d7e3c4c9454133e7b21165bb7c3953">00769</a>     <span class="keyword">const</span> <a class="code" href="classCassandra.html#aa3d7e3c4c9454133e7b21165bb7c3953">INDEX_KEYS</a> = 0;
<a name="l00770"></a>00770     
<a name="l00779"></a><a class="code" href="classCassandra.html#a92574efcf6569a6e2e6f82b6101e83d2">00779</a>     <span class="keyword">private</span> function <a class="code" href="classCassandra.html#a92574efcf6569a6e2e6f82b6101e83d2">__construct</a>(array $servers = array(), $autopack = <span class="keyword">true</span>) {
<a name="l00780"></a>00780         $this-&gt;cluster = <span class="keyword">new</span> <a class="code" href="classCassandraCluster.html">CassandraCluster</a>($servers);
<a name="l00781"></a>00781         $this-&gt;autopack = $autopack;
<a name="l00782"></a>00782     }
<a name="l00783"></a>00783     
<a name="l00787"></a><a class="code" href="classCassandra.html#abb13b5073e065e8f2a60b1c6f18c573e">00787</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#abb13b5073e065e8f2a60b1c6f18c573e">__clone</a>() {
<a name="l00788"></a>00788         trigger_error(<span class="stringliteral">&#39;Clone is not allowed.&#39;</span>, E_USER_ERROR);
<a name="l00789"></a>00789     }
<a name="l00790"></a>00790     
<a name="l00801"></a><a class="code" href="classCassandra.html#a0eb2d8394ec9b98363eb2ea13c3390a6">00801</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandra.html#a0eb2d8394ec9b98363eb2ea13c3390a6">createInstance</a>(array $servers, $name = <span class="stringliteral">&#39;main&#39;</span>) {
<a name="l00802"></a>00802         self::$instances[$name] = <span class="keyword">new</span> <span class="keyword">self</span>($servers);
<a name="l00803"></a>00803         
<a name="l00804"></a>00804         <span class="keywordflow">return</span> self::$instances[$name];
<a name="l00805"></a>00805     }
<a name="l00806"></a>00806     
<a name="l00817"></a><a class="code" href="classCassandra.html#accae5522cc54a2f679f7925752d14c01">00817</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandra.html#accae5522cc54a2f679f7925752d14c01">getInstance</a>($name = <span class="stringliteral">&#39;main&#39;</span>) {
<a name="l00818"></a>00818         <span class="keywordflow">if</span> (!isset(self::$instances[$name])) {
<a name="l00819"></a>00819             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l00820"></a>00820                 <span class="stringliteral">&#39;Instance called &quot;&#39;</span>.$name.<span class="stringliteral">&#39;&quot; does not exist&#39;</span>
<a name="l00821"></a>00821             );
<a name="l00822"></a>00822         }
<a name="l00823"></a>00823         
<a name="l00824"></a>00824         <span class="keywordflow">return</span> self::$instances[$name];
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826     
<a name="l00834"></a><a class="code" href="classCassandra.html#a22c9c1782896b9ee47117643c89f0052">00834</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandra.html#a22c9c1782896b9ee47117643c89f0052">registerKeyspace</a>(
<a name="l00835"></a>00835         $keyspace,
<a name="l00836"></a>00836         $username = null,
<a name="l00837"></a>00837         $password = null
<a name="l00838"></a>00838     ) {
<a name="l00839"></a>00839         $this-&gt;keyspaceAuthentication[$keyspace] = array(
<a name="l00840"></a>00840             <span class="stringliteral">&#39;username&#39;</span> =&gt; $username,
<a name="l00841"></a>00841             <span class="stringliteral">&#39;password&#39;</span> =&gt; $password
<a name="l00842"></a>00842         );
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844     
<a name="l00858"></a><a class="code" href="classCassandra.html#a4502befdb4278113462bc7fcfbafa09f">00858</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a4502befdb4278113462bc7fcfbafa09f">useKeyspace</a>($keyspace, $username = null, $password = null) {
<a name="l00859"></a>00859         <span class="keywordflow">if</span> (!empty($username)) {
<a name="l00860"></a>00860             $this-&gt;<a class="code" href="classCassandra.html#a22c9c1782896b9ee47117643c89f0052">registerKeyspace</a>($keyspace, $username, $password);
<a name="l00861"></a>00861         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isset($this-&gt;keyspaceAuthentication[$keyspace])) {
<a name="l00862"></a>00862             $username = $this-&gt;keyspaceAuthentication[$keyspace][<span class="stringliteral">&#39;username&#39;</span>];
<a name="l00863"></a>00863             $password = $this-&gt;keyspaceAuthentication[$keyspace][<span class="stringliteral">&#39;password&#39;</span>];
<a name="l00864"></a>00864         }
<a name="l00865"></a>00865         
<a name="l00866"></a>00866         $this-&gt;cluster-&gt;useKeyspace($keyspace, $username, $password);
<a name="l00867"></a>00867         
<a name="l00868"></a>00868         <span class="keywordflow">return</span> $this;
<a name="l00869"></a>00869     }
<a name="l00870"></a>00870     
<a name="l00876"></a><a class="code" href="classCassandra.html#ad8fe43e1ceb9841cca92cf981fb566b3">00876</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#ad8fe43e1ceb9841cca92cf981fb566b3">getCluster</a>() {
<a name="l00877"></a>00877         <span class="keywordflow">return</span> $this-&gt;cluster;
<a name="l00878"></a>00878     }
<a name="l00879"></a>00879     
<a name="l00885"></a><a class="code" href="classCassandra.html#ac300f4b8ed3a2d80388225e0ec990883">00885</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#ac300f4b8ed3a2d80388225e0ec990883">getConnection</a>() {
<a name="l00886"></a>00886         <span class="keywordflow">return</span> $this-&gt;cluster-&gt;getConnection();
<a name="l00887"></a>00887     }
<a name="l00888"></a>00888     
<a name="l00894"></a><a class="code" href="classCassandra.html#a382ebe135b67bddef1e0a9fa21448cde">00894</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a382ebe135b67bddef1e0a9fa21448cde">closeConnections</a>() {
<a name="l00895"></a>00895         $this-&gt;cluster-&gt;closeConnections();
<a name="l00896"></a>00896     }
<a name="l00897"></a>00897     
<a name="l00903"></a><a class="code" href="classCassandra.html#a4eaaed3e996a26cc145057487036584b">00903</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a4eaaed3e996a26cc145057487036584b">getClient</a>() {
<a name="l00904"></a>00904         <span class="keywordflow">return</span> $this-&gt;cluster-&gt;getConnection()-&gt;getClient();
<a name="l00905"></a>00905     }
<a name="l00906"></a>00906     
<a name="l00914"></a><a class="code" href="classCassandra.html#aea614dd2c8170609c0ec9e81607983a0">00914</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#aea614dd2c8170609c0ec9e81607983a0">setMaxCallRetries</a>($retryCount) {
<a name="l00915"></a>00915         $this-&gt;maxCallRetries = $retryCount;
<a name="l00916"></a>00916         
<a name="l00917"></a>00917         <span class="keywordflow">return</span> $this;
<a name="l00918"></a>00918     }
<a name="l00919"></a>00919     
<a name="l00925"></a><a class="code" href="classCassandra.html#af62c6e8771c55cfe9a94e8a6551a5e1b">00925</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#af62c6e8771c55cfe9a94e8a6551a5e1b">setDefaultColumnCount</a>($columnCountLimit) {
<a name="l00926"></a>00926         $this-&gt;defaultColumnCount = $columnCountLimit;
<a name="l00927"></a>00927     }
<a name="l00928"></a>00928     
<a name="l00943"></a><a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">00943</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="comment">/*$methodName, $arg1, $arg2 */</span>) {
<a name="l00944"></a>00944         $args = func_get_args();
<a name="l00945"></a>00945         $methodName = array_shift($args);
<a name="l00946"></a>00946         
<a name="l00947"></a>00947         $tries = $this-&gt;maxCallRetries;
<a name="l00948"></a>00948         $lastException = null;
<a name="l00949"></a>00949         
<a name="l00950"></a>00950         $keyspaceRequiredMethods = <a class="code" href="classCassandra.html#ad051f9ef0cdc597c5838124c58e9f962">self::getKeyspaceRequiredMethods</a>();
<a name="l00951"></a>00951         
<a name="l00952"></a>00952         <span class="keywordflow">if</span> (
<a name="l00953"></a>00953             in_array($methodName, $keyspaceRequiredMethods)
<a name="l00954"></a>00954             &amp;&amp; $this-&gt;cluster-&gt;getCurrentKeyspace() === null
<a name="l00955"></a>00955         ) {
<a name="l00956"></a>00956             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l00957"></a>00957                 <span class="stringliteral">&#39;Unable to call &quot;&#39;</span>.$methodName.<span class="stringliteral">&#39;&quot;, no keyspace has been set&#39;</span>
<a name="l00958"></a>00958             );
<a name="l00959"></a>00959         }
<a name="l00960"></a>00960         
<a name="l00961"></a>00961         $try = 0;
<a name="l00962"></a>00962         
<a name="l00963"></a>00963         <span class="keywordflow">while</span>($tries-- &gt; 0) {
<a name="l00964"></a>00964             $client = $this-&gt;<a class="code" href="classCassandra.html#a4eaaed3e996a26cc145057487036584b">getClient</a>();
<a name="l00965"></a>00965             $try++;
<a name="l00966"></a>00966             
<a name="l00967"></a>00967             <span class="keywordflow">try</span> {
<a name="l00968"></a>00968                 <span class="keywordflow">return</span> call_user_func_array(array($client, $methodName), $args);
<a name="l00969"></a>00969             } <span class="keywordflow">catch</span> (Exception $e) {
<a name="l00970"></a>00970                 $lastException = $e;
<a name="l00971"></a>00971                 
<a name="l00972"></a>00972                 usleep(0.1 * pow(2, $try) * 1000000);
<a name="l00973"></a>00973             }
<a name="l00974"></a>00974         }
<a name="l00975"></a>00975 
<a name="l00976"></a>00976         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraMaxRetriesException.html">CassandraMaxRetriesException</a>(
<a name="l00977"></a>00977             <span class="stringliteral">&#39;Failed calling &quot;&#39;</span>.$methodName.<span class="stringliteral">&#39;&quot; the maximum of &#39;</span>.
<a name="l00978"></a>00978             $this-&gt;maxCallRetries.<span class="stringliteral">&#39; times&#39;</span>,
<a name="l00979"></a>00979             $lastException-&gt;getCode(),
<a name="l00980"></a>00980             $lastException
<a name="l00981"></a>00981         );
<a name="l00982"></a>00982     }
<a name="l00983"></a>00983     
<a name="l00996"></a><a class="code" href="classCassandra.html#a6ba87c8d96b73a8b13f61711c5df9e52">00996</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a6ba87c8d96b73a8b13f61711c5df9e52">describeKeyspace</a>($keyspace = null) {
<a name="l00997"></a>00997         <span class="keywordflow">if</span> ($keyspace === null) {
<a name="l00998"></a>00998             $keyspace = $this-&gt;cluster-&gt;getCurrentKeyspace();
<a name="l00999"></a>00999         }
<a name="l01000"></a>01000         
<a name="l01001"></a>01001         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="stringliteral">&#39;describe_keyspace&#39;</span>, $keyspace);
<a name="l01002"></a>01002     }
<a name="l01003"></a>01003     
<a name="l01012"></a><a class="code" href="classCassandra.html#a67612b010f1a48882ca0ad6888fab31f">01012</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a67612b010f1a48882ca0ad6888fab31f">getKeyspaceSchema</a>($keyspace = null, $useCache = <span class="keyword">true</span>) {
<a name="l01013"></a>01013         <span class="keywordflow">if</span> ($keyspace === null) {
<a name="l01014"></a>01014             $keyspace = $this-&gt;cluster-&gt;getCurrentKeyspace();
<a name="l01015"></a>01015         }
<a name="l01016"></a>01016         
<a name="l01017"></a>01017         $cacheKey = <span class="stringliteral">&#39;cassandra.schema|&#39;</span>.$keyspace;
<a name="l01018"></a>01018 
<a name="l01019"></a>01019         $schema = <span class="keyword">false</span>;
<a name="l01020"></a>01020         $storeSchema = <span class="keyword">false</span>;
<a name="l01021"></a>01021         
<a name="l01022"></a>01022         <span class="keywordflow">if</span> ($useCache &amp;&amp; function_exists(<span class="stringliteral">&#39;apc_fetch&#39;</span>)) {
<a name="l01023"></a>01023             $schema = apc_fetch($cacheKey);
<a name="l01024"></a>01024             $storeSchema = <span class="keyword">true</span>;
<a name="l01025"></a>01025         }
<a name="l01026"></a>01026 
<a name="l01027"></a>01027         <span class="keywordflow">if</span> ($schema !== <span class="keyword">false</span>) {
<a name="l01028"></a>01028             <span class="keywordflow">return</span> $schema;
<a name="l01029"></a>01029         }
<a name="l01030"></a>01030 
<a name="l01031"></a>01031         $info = $this-&gt;<a class="code" href="classCassandra.html#a6ba87c8d96b73a8b13f61711c5df9e52">describeKeyspace</a>($keyspace);
<a name="l01032"></a>01032         
<a name="l01033"></a>01033         $schema = array(
<a name="l01034"></a>01034             <span class="stringliteral">&#39;name&#39;</span> =&gt; $info-&gt;name,
<a name="l01035"></a>01035             <span class="stringliteral">&#39;placement-strategy&#39;</span> =&gt; $info-&gt;strategy_class,
<a name="l01036"></a>01036             <span class="stringliteral">&#39;placement-strategy-options&#39;</span> =&gt; $info-&gt;strategy_options,
<a name="l01037"></a>01037             <span class="stringliteral">&#39;replication-factor&#39;</span> =&gt; $info-&gt;replication_factor,
<a name="l01038"></a>01038             <span class="stringliteral">&#39;column-families&#39;</span> =&gt; array()
<a name="l01039"></a>01039         );
<a name="l01040"></a>01040         
<a name="l01041"></a>01041         <span class="keywordflow">foreach</span> ($info-&gt;cf_defs as $columnFamily) {
<a name="l01042"></a>01042             $isSuper = $columnFamily-&gt;column_type == <span class="stringliteral">&#39;Super&#39;</span> ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l01043"></a>01043             
<a name="l01044"></a>01044             $schema[<span class="stringliteral">&#39;column-families&#39;</span>][$columnFamily-&gt;name] = array(
<a name="l01045"></a>01045                 <span class="stringliteral">&#39;name&#39;</span> =&gt; $columnFamily-&gt;name,
<a name="l01046"></a>01046                 <span class="stringliteral">&#39;super&#39;</span> =&gt; $isSuper,
<a name="l01047"></a>01047                 <span class="stringliteral">&#39;column-type&#39;</span> =&gt;
<a name="l01048"></a>01048                     $isSuper
<a name="l01049"></a>01049                         ? <a class="code" href="classCassandraUtil.html#a0c6545c1306d917051a53598a0f23ee6">CassandraUtil::extractType</a>(
<a name="l01050"></a>01050                             $columnFamily-&gt;subcomparator_type
<a name="l01051"></a>01051                         )
<a name="l01052"></a>01052                         : <a class="code" href="classCassandraUtil.html#a0c6545c1306d917051a53598a0f23ee6">CassandraUtil::extractType</a>(
<a name="l01053"></a>01053                             $columnFamily-&gt;comparator_type
<a name="l01054"></a>01054                         ),
<a name="l01055"></a>01055                 <span class="stringliteral">&#39;super-type&#39;</span> =&gt;
<a name="l01056"></a>01056                     $isSuper
<a name="l01057"></a>01057                         ? <a class="code" href="classCassandraUtil.html#a0c6545c1306d917051a53598a0f23ee6">CassandraUtil::extractType</a>(
<a name="l01058"></a>01058                             $columnFamily-&gt;comparator_type
<a name="l01059"></a>01059                         )
<a name="l01060"></a>01060                         : null,
<a name="l01061"></a>01061                 <span class="stringliteral">&#39;data-type&#39;</span> =&gt; <a class="code" href="classCassandraUtil.html#a0c6545c1306d917051a53598a0f23ee6">CassandraUtil::extractType</a>(
<a name="l01062"></a>01062                     $columnFamily-&gt;default_validation_class
<a name="l01063"></a>01063                 ),
<a name="l01064"></a>01064                 <span class="stringliteral">&#39;column-data-types&#39;</span> =&gt; array()
<a name="l01065"></a>01065             );
<a name="l01066"></a>01066 
<a name="l01067"></a>01067             <span class="keywordflow">if</span> (
<a name="l01068"></a>01068                 is_array($columnFamily-&gt;column_metadata)
<a name="l01069"></a>01069                 &amp;&amp; !empty($columnFamily-&gt;column_metadata)
<a name="l01070"></a>01070             ) {
<a name="l01071"></a>01071                 <span class="keywordflow">foreach</span> ($columnFamily-&gt;column_metadata as $column) {
<a name="l01072"></a>01072                     $schema[<span class="stringliteral">&#39;column-families&#39;</span>][$columnFamily-&gt;name][<span class="stringliteral">&#39;column-data-types&#39;</span>][$column-&gt;name]
<a name="l01073"></a>01073                         = <a class="code" href="classCassandraUtil.html#a0c6545c1306d917051a53598a0f23ee6">CassandraUtil::extractType</a>($column-&gt;validation_class);
<a name="l01074"></a>01074                 }
<a name="l01075"></a>01075             }
<a name="l01076"></a>01076         }
<a name="l01077"></a>01077         
<a name="l01078"></a>01078         <span class="keywordflow">if</span> ($storeSchema) {
<a name="l01079"></a>01079             apc_store($cacheKey, $schema, 3600);
<a name="l01080"></a>01080         }
<a name="l01081"></a>01081         
<a name="l01082"></a>01082         <span class="keywordflow">return</span> $schema;
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084     
<a name="l01090"></a><a class="code" href="classCassandra.html#a3291b2ab3dc093e22df8a428321f2492">01090</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a3291b2ab3dc093e22df8a428321f2492">getVersion</a>() {
<a name="l01091"></a>01091         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="stringliteral">&#39;describe_version&#39;</span>);
<a name="l01092"></a>01092     }
<a name="l01093"></a>01093     
<a name="l01100"></a><a class="code" href="classCassandra.html#a4d61f35bafba5e3e2b82b33671ce7831">01100</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a4d61f35bafba5e3e2b82b33671ce7831">cf</a>($name) {
<a name="l01101"></a>01101         <span class="keywordflow">if</span> (!isset($this-&gt;columnFamilies[$name])) {
<a name="l01102"></a>01102             $this-&gt;columnFamilies[$name] = <span class="keyword">new</span> <a class="code" href="classCassandraColumnFamily.html">CassandraColumnFamily</a>(
<a name="l01103"></a>01103                 $this,
<a name="l01104"></a>01104                 $name,
<a name="l01105"></a>01105                 <a class="code" href="classCassandra.html#afd35e5b7419ce2915891c349a44b6f22">Cassandra::CONSISTENCY_ONE</a>,
<a name="l01106"></a>01106                 <a class="code" href="classCassandra.html#afd35e5b7419ce2915891c349a44b6f22">Cassandra::CONSISTENCY_ONE</a>,
<a name="l01107"></a>01107                 $this-&gt;autopack
<a name="l01108"></a>01108             );
<a name="l01109"></a>01109         }
<a name="l01110"></a>01110         
<a name="l01111"></a>01111         <span class="keywordflow">return</span> $this-&gt;columnFamilies[$name];
<a name="l01112"></a>01112     }
<a name="l01113"></a>01113     
<a name="l01122"></a><a class="code" href="classCassandra.html#a4e450d22e7ae8575cca647970edb54d5">01122</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a4e450d22e7ae8575cca647970edb54d5">columnFamily</a>($name) {
<a name="l01123"></a>01123         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a4d61f35bafba5e3e2b82b33671ce7831">cf</a>($name);
<a name="l01124"></a>01124     }
<a name="l01125"></a>01125     
<a name="l01143"></a><a class="code" href="classCassandra.html#ad2f8866d598ac0f696cb0c87258133fb">01143</a>     <span class="keyword">public</span> function <span class="keyword">get</span>($request, $consistency = null) {
<a name="l01144"></a>01144         $details = $this-&gt;<a class="code" href="classCassandra.html#a960d23553468532df3d4c6bf712bb2f7">parseRequest</a>($request);
<a name="l01145"></a>01145 
<a name="l01146"></a>01146         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a4d61f35bafba5e3e2b82b33671ce7831">cf</a>($details[<span class="stringliteral">&#39;column-family&#39;</span>])-&gt;get(
<a name="l01147"></a>01147             $details[<span class="stringliteral">&#39;key&#39;</span>],
<a name="l01148"></a>01148             $details[<span class="stringliteral">&#39;columns&#39;</span>],
<a name="l01149"></a>01149             $details[<span class="stringliteral">&#39;start-column&#39;</span>],
<a name="l01150"></a>01150             $details[<span class="stringliteral">&#39;end-column&#39;</span>],
<a name="l01151"></a>01151             $details[<span class="stringliteral">&#39;reversed&#39;</span>],
<a name="l01152"></a>01152             $details[<span class="stringliteral">&#39;column-count&#39;</span>],
<a name="l01153"></a>01153             $details[<span class="stringliteral">&#39;super-column&#39;</span>],
<a name="l01154"></a>01154             $consistency
<a name="l01155"></a>01155         );
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157     
<a name="l01172"></a><a class="code" href="classCassandra.html#ada5af7349bbec677ea2b068b4f426707">01172</a>     <span class="keyword">public</span> function <span class="keyword">set</span>($key, array $columns, $consistency = null) {
<a name="l01173"></a>01173         $dotPosition = mb_strpos($key, <span class="charliteral">&#39;.&#39;</span>);
<a name="l01174"></a>01174         
<a name="l01175"></a>01175         <span class="keywordflow">if</span> ($dotPosition === <span class="keyword">false</span>) {
<a name="l01176"></a>01176             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidPatternException.html">CassandraInvalidPatternException</a>(
<a name="l01177"></a>01177                 <span class="stringliteral">&#39;Unable to set &quot;&#39;</span>.$key.<span class="stringliteral">&#39;&quot;, expected the column family name and&#39;</span>.
<a name="l01178"></a>01178                 <span class="stringliteral">&#39;key name seperated by a fullstop&#39;</span>
<a name="l01179"></a>01179             );
<a name="l01180"></a>01180         }
<a name="l01181"></a>01181         
<a name="l01182"></a>01182         $columnFamilyName = mb_substr($key, 0, $dotPosition);
<a name="l01183"></a>01183         $keyName = mb_substr($key, $dotPosition + 1);
<a name="l01184"></a>01184         
<a name="l01185"></a>01185         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a4d61f35bafba5e3e2b82b33671ce7831">cf</a>($columnFamilyName)-&gt;set(
<a name="l01186"></a>01186             $keyName,
<a name="l01187"></a>01187             $columns,
<a name="l01188"></a>01188             $consistency
<a name="l01189"></a>01189         );
<a name="l01190"></a>01190     }
<a name="l01191"></a>01191     
<a name="l01207"></a><a class="code" href="classCassandra.html#ab249eab7f62e3076829c1f4e376dbc18">01207</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#ab249eab7f62e3076829c1f4e376dbc18">createKeyspace</a>(
<a name="l01208"></a>01208         $name,
<a name="l01209"></a>01209         $replicationFactor = 1,
<a name="l01210"></a>01210         $placementStrategyClass = self::PLACEMENT_SIMPLE,
<a name="l01211"></a>01211         $placementStrategyOptions = null
<a name="l01212"></a>01212     ) {
<a name="l01213"></a>01213         $def = <span class="keyword">new</span> cassandra_KsDef();
<a name="l01214"></a>01214         
<a name="l01215"></a>01215         $def-&gt;name = $name;
<a name="l01216"></a>01216         $def-&gt;strategy_class = $placementStrategyClass;
<a name="l01217"></a>01217         $def-&gt;strategy_options = $placementStrategyOptions;
<a name="l01218"></a>01218         $def-&gt;cf_defs = array();
<a name="l01219"></a>01219         $def-&gt;replication_factor = $replicationFactor;
<a name="l01220"></a>01220         
<a name="l01221"></a>01221         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="stringliteral">&#39;system_add_keyspace&#39;</span>, $def);
<a name="l01222"></a>01222     }
<a name="l01223"></a>01223     
<a name="l01239"></a><a class="code" href="classCassandra.html#a4b0b56e3354e7d59efa5a0fdda488be1">01239</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a4b0b56e3354e7d59efa5a0fdda488be1">updateKeyspace</a>(
<a name="l01240"></a>01240         $name,
<a name="l01241"></a>01241         $replicationFactor = 1,
<a name="l01242"></a>01242         $placementStrategyClass = self::PLACEMENT_SIMPLE,
<a name="l01243"></a>01243         $placementStrategyOptions = null
<a name="l01244"></a>01244     ) {
<a name="l01245"></a>01245         $def = <span class="keyword">new</span> cassandra_KsDef();
<a name="l01246"></a>01246         
<a name="l01247"></a>01247         $def-&gt;name = $name;
<a name="l01248"></a>01248         $def-&gt;strategy_class = $placementStrategyClass;
<a name="l01249"></a>01249         $def-&gt;strategy_options = $placementStrategyOptions;
<a name="l01250"></a>01250         $def-&gt;cf_defs = array();
<a name="l01251"></a>01251         $def-&gt;replication_factor = $replicationFactor;
<a name="l01252"></a>01252         
<a name="l01253"></a>01253         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="stringliteral">&#39;system_update_keyspace&#39;</span>, $def);
<a name="l01254"></a>01254     }
<a name="l01255"></a>01255     
<a name="l01263"></a><a class="code" href="classCassandra.html#a1422aecd02d9727bc26f1d6546a10151">01263</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a1422aecd02d9727bc26f1d6546a10151">dropKeyspace</a>($name) {
<a name="l01264"></a>01264         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="stringliteral">&#39;system_drop_keyspace&#39;</span>, $name);
<a name="l01265"></a>01265     }
<a name="l01266"></a>01266     
<a name="l01289"></a><a class="code" href="classCassandra.html#a382ac999e181b0d0f735a76ddf28d0ff">01289</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a382ac999e181b0d0f735a76ddf28d0ff">createStandardColumnFamily</a>(
<a name="l01290"></a>01290         $keyspace,
<a name="l01291"></a>01291         $name,
<a name="l01292"></a>01292         $columns = array(),
<a name="l01293"></a>01293         $comparatorType = <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>,
<a name="l01294"></a>01294         $defaultValidationClass = <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>,
<a name="l01295"></a>01295         $comment = null,
<a name="l01296"></a>01296         $rowCacheSize = null,
<a name="l01297"></a>01297         $keyCacheSize = null,
<a name="l01298"></a>01298         $readRepairChance = null,
<a name="l01299"></a>01299         $cgGraceSeconds = null,
<a name="l01300"></a>01300         $minCompactionThreshold = null,
<a name="l01301"></a>01301         $maxCompactionThreshold = null,
<a name="l01302"></a>01302         $rowCacheSavePeriodSeconds = null,
<a name="l01303"></a>01303         $keyCacheSavePeriodSeconds = null,
<a name="l01304"></a>01304         $memtableFlushAfterMins = null,
<a name="l01305"></a>01305         $memtableFlushAfterThroughputMb = null,
<a name="l01306"></a>01306         $memtableFlushAfterOpsMillions = null
<a name="l01307"></a>01307     ) {
<a name="l01308"></a>01308         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a19f2f88752029346ee737805a0d3c022">createColumnFamily</a>(
<a name="l01309"></a>01309             $keyspace,
<a name="l01310"></a>01310             $name,
<a name="l01311"></a>01311             <a class="code" href="classCassandra.html#a5b7fd78b8f044623445d9e9a8f175790">Cassandra::COLUMN_STANDARD</a>,
<a name="l01312"></a>01312             $columns,
<a name="l01313"></a>01313             $comparatorType,
<a name="l01314"></a>01314             null,
<a name="l01315"></a>01315             $defaultValidationClass,
<a name="l01316"></a>01316             $comment,
<a name="l01317"></a>01317             $rowCacheSize,
<a name="l01318"></a>01318             $keyCacheSize,
<a name="l01319"></a>01319             $readRepairChance,
<a name="l01320"></a>01320             $cgGraceSeconds,
<a name="l01321"></a>01321             $minCompactionThreshold,
<a name="l01322"></a>01322             $maxCompactionThreshold,
<a name="l01323"></a>01323             $rowCacheSavePeriodSeconds,
<a name="l01324"></a>01324             $keyCacheSavePeriodSeconds,
<a name="l01325"></a>01325             $memtableFlushAfterMins,
<a name="l01326"></a>01326             $memtableFlushAfterThroughputMb,
<a name="l01327"></a>01327             $memtableFlushAfterOpsMillions
<a name="l01328"></a>01328         );
<a name="l01329"></a>01329     }
<a name="l01330"></a>01330     
<a name="l01353"></a><a class="code" href="classCassandra.html#a121a87352eb88b7dc8de38188ecdd8c6">01353</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a121a87352eb88b7dc8de38188ecdd8c6">createSuperColumnFamily</a>(
<a name="l01354"></a>01354         $keyspace,
<a name="l01355"></a>01355         $name,
<a name="l01356"></a>01356         $columns = array(),
<a name="l01357"></a>01357         $comparatorType = <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>,
<a name="l01358"></a>01358         $subcomparatorType = <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>,
<a name="l01359"></a>01359         $defaultValidationClass = <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>,
<a name="l01360"></a>01360         $comment = null,
<a name="l01361"></a>01361         $rowCacheSize = null,
<a name="l01362"></a>01362         $keyCacheSize = null,
<a name="l01363"></a>01363         $readRepairChance = null,
<a name="l01364"></a>01364         $cgGraceSeconds = null,
<a name="l01365"></a>01365         $minCompactionThreshold = null,
<a name="l01366"></a>01366         $maxCompactionThreshold = null,
<a name="l01367"></a>01367         $rowCacheSavePeriodSeconds = null,
<a name="l01368"></a>01368         $keyCacheSavePeriodSeconds = null,
<a name="l01369"></a>01369         $memtableFlushAfterMins = null,
<a name="l01370"></a>01370         $memtableFlushAfterThroughputMb = null,
<a name="l01371"></a>01371         $memtableFlushAfterOpsMillions = null
<a name="l01372"></a>01372     ) {
<a name="l01373"></a>01373         <span class="keywordflow">foreach</span> ($columns as $column) {
<a name="l01374"></a>01374             <span class="keywordflow">if</span> (
<a name="l01375"></a>01375                 array_key_exists(<span class="stringliteral">&#39;index-type&#39;</span>, $column)
<a name="l01376"></a>01376                 || array_key_exists(<span class="stringliteral">&#39;index-name&#39;</span>, $column)
<a name="l01377"></a>01377             ) {
<a name="l01378"></a>01378                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraUnsupportedException.html">CassandraUnsupportedException</a>(
<a name="l01379"></a>01379                     <span class="stringliteral">&#39;Secondary indexes are not supported by supercolumns&#39;</span>
<a name="l01380"></a>01380                 );
<a name="l01381"></a>01381             }
<a name="l01382"></a>01382         }
<a name="l01383"></a>01383         
<a name="l01384"></a>01384         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a19f2f88752029346ee737805a0d3c022">createColumnFamily</a>(
<a name="l01385"></a>01385             $keyspace,
<a name="l01386"></a>01386             $name,
<a name="l01387"></a>01387             <a class="code" href="classCassandra.html#abf8e49b590d1e1b83d3e13cc133cd672">Cassandra::COLUMN_SUPER</a>,
<a name="l01388"></a>01388             $columns,
<a name="l01389"></a>01389             $comparatorType,
<a name="l01390"></a>01390             $subcomparatorType,
<a name="l01391"></a>01391             $defaultValidationClass,
<a name="l01392"></a>01392             $comment,
<a name="l01393"></a>01393             $rowCacheSize,
<a name="l01394"></a>01394             $keyCacheSize,
<a name="l01395"></a>01395             $readRepairChance,
<a name="l01396"></a>01396             $cgGraceSeconds,
<a name="l01397"></a>01397             $minCompactionThreshold,
<a name="l01398"></a>01398             $maxCompactionThreshold,
<a name="l01399"></a>01399             $rowCacheSavePeriodSeconds,
<a name="l01400"></a>01400             $keyCacheSavePeriodSeconds,
<a name="l01401"></a>01401             $memtableFlushAfterMins,
<a name="l01402"></a>01402             $memtableFlushAfterThroughputMb,
<a name="l01403"></a>01403             $memtableFlushAfterOpsMillions
<a name="l01404"></a>01404         );
<a name="l01405"></a>01405     }
<a name="l01406"></a>01406     
<a name="l01433"></a><a class="code" href="classCassandra.html#a19f2f88752029346ee737805a0d3c022">01433</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#a19f2f88752029346ee737805a0d3c022">createColumnFamily</a>(
<a name="l01434"></a>01434         $keyspace,
<a name="l01435"></a>01435         $name,
<a name="l01436"></a>01436         $columnType = <a class="code" href="classCassandra.html#a5b7fd78b8f044623445d9e9a8f175790">Cassandra::COLUMN_STANDARD</a>,
<a name="l01437"></a>01437         $columns = array(),
<a name="l01438"></a>01438         $comparatorType = <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>,
<a name="l01439"></a>01439         $subcomparatorType = null,
<a name="l01440"></a>01440         $defaultValidationClass = <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>,
<a name="l01441"></a>01441         $comment = null,
<a name="l01442"></a>01442         $rowCacheSize = null,
<a name="l01443"></a>01443         $keyCacheSize = null,
<a name="l01444"></a>01444         $readRepairChance = null,
<a name="l01445"></a>01445         $cgGraceSeconds = null,
<a name="l01446"></a>01446         $minCompactionThreshold = null,
<a name="l01447"></a>01447         $maxCompactionThreshold = null,
<a name="l01448"></a>01448         $rowCacheSavePeriodSeconds = null,
<a name="l01449"></a>01449         $keyCacheSavePeriodSeconds = null,
<a name="l01450"></a>01450         $memtableFlushAfterMins = null,
<a name="l01451"></a>01451         $memtableFlushAfterThroughputMb = null,
<a name="l01452"></a>01452         $memtableFlushAfterOpsMillions = null
<a name="l01453"></a>01453     ) {
<a name="l01454"></a>01454         $columnMetadata = null;
<a name="l01455"></a>01455         
<a name="l01456"></a>01456         <span class="keywordflow">if</span> (!empty($columns)) {
<a name="l01457"></a>01457             $columnMetadata = array();
<a name="l01458"></a>01458             
<a name="l01459"></a>01459             <span class="keywordflow">foreach</span> ($columns as $column) {
<a name="l01460"></a>01460                 $columnMetadata[] = $this-&gt;<a class="code" href="classCassandra.html#a48c9d0cb51ea0ac56949b7865760ed5e">createColumnDefinition</a>($column);
<a name="l01461"></a>01461             }
<a name="l01462"></a>01462         }
<a name="l01463"></a>01463         
<a name="l01464"></a>01464         $def = <span class="keyword">new</span> cassandra_CfDef();
<a name="l01465"></a>01465         
<a name="l01466"></a>01466         $def-&gt;keyspace = $keyspace;
<a name="l01467"></a>01467         $def-&gt;name = $name;
<a name="l01468"></a>01468         $def-&gt;column_type = $columnType;
<a name="l01469"></a>01469         $def-&gt;comparator_type = $comparatorType;
<a name="l01470"></a>01470         $def-&gt;subcomparator_type = $subcomparatorType;
<a name="l01471"></a>01471         $def-&gt;comment = $comment;
<a name="l01472"></a>01472         $def-&gt;row_cache_size = $rowCacheSize;
<a name="l01473"></a>01473         
<a name="l01474"></a>01474         <span class="keywordflow">if</span> ($keyCacheSize !== null) {
<a name="l01475"></a>01475             $def-&gt;key_cache_size = $keyCacheSize;
<a name="l01476"></a>01476         }
<a name="l01477"></a>01477         
<a name="l01478"></a>01478         $def-&gt;read_repair_chance = $readRepairChance;
<a name="l01479"></a>01479         $def-&gt;column_metadata = $columnMetadata;
<a name="l01480"></a>01480         $def-&gt;gc_grace_seconds = $cgGraceSeconds;
<a name="l01481"></a>01481         $def-&gt;default_validation_class = $defaultValidationClass;
<a name="l01482"></a>01482         $def-&gt;min_compaction_threshold = $minCompactionThreshold;
<a name="l01483"></a>01483         $def-&gt;max_compaction_threshold = $maxCompactionThreshold;
<a name="l01484"></a>01484         $def-&gt;row_cache_save_period_in_seconds = $rowCacheSavePeriodSeconds;
<a name="l01485"></a>01485         $def-&gt;key_cache_save_period_in_seconds = $keyCacheSavePeriodSeconds;
<a name="l01486"></a>01486         $def-&gt;memtable_flush_after_mins = $memtableFlushAfterMins;
<a name="l01487"></a>01487         $def-&gt;memtable_throughput_in_mb = $memtableFlushAfterThroughputMb;
<a name="l01488"></a>01488         $def-&gt;memtable_operations_in_millions = $memtableFlushAfterOpsMillions;
<a name="l01489"></a>01489 
<a name="l01490"></a>01490         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="stringliteral">&#39;system_add_column_family&#39;</span>, $def);
<a name="l01491"></a>01491     }
<a name="l01492"></a>01492     
<a name="l01499"></a><a class="code" href="classCassandra.html#ad5b9ce7720a1c4b015abaaea988edfe1">01499</a>     <span class="keyword">public</span> function <a class="code" href="classCassandra.html#ad5b9ce7720a1c4b015abaaea988edfe1">truncate</a>($columnFamilyName) {
<a name="l01500"></a>01500         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandra.html#a5a83ae74dca462d6d7527c2a682ae550">call</a>(<span class="stringliteral">&#39;truncate&#39;</span>, $columnFamilyName);
<a name="l01501"></a>01501     }
<a name="l01502"></a>01502     
<a name="l01509"></a><a class="code" href="classCassandra.html#ad051f9ef0cdc597c5838124c58e9f962">01509</a>     <span class="keyword">protected</span> <span class="keyword">static</span> function <a class="code" href="classCassandra.html#ad051f9ef0cdc597c5838124c58e9f962">getKeyspaceRequiredMethods</a>() {
<a name="l01510"></a>01510         <span class="keywordflow">if</span> (self::$keyspaceRequiredMethods === null) {
<a name="l01511"></a>01511             self::$keyspaceRequiredMethods = array(
<a name="l01512"></a>01512                 <span class="stringliteral">&#39;login&#39;</span>,
<a name="l01513"></a>01513                 <span class="stringliteral">&#39;get&#39;</span>,
<a name="l01514"></a>01514                 <span class="stringliteral">&#39;get_slice&#39;</span>,
<a name="l01515"></a>01515                 <span class="stringliteral">&#39;get_count&#39;</span>,
<a name="l01516"></a>01516                 <span class="stringliteral">&#39;multiget_slice&#39;</span>,
<a name="l01517"></a>01517                 <span class="stringliteral">&#39;multiget_count&#39;</span>,
<a name="l01518"></a>01518                 <span class="stringliteral">&#39;get_indexed_slices&#39;</span>,
<a name="l01519"></a>01519                 <span class="stringliteral">&#39;insert&#39;</span>,
<a name="l01520"></a>01520                 <span class="stringliteral">&#39;remove&#39;</span>,
<a name="l01521"></a>01521                 <span class="stringliteral">&#39;batch_mutate&#39;</span>,
<a name="l01522"></a>01522                 <span class="stringliteral">&#39;truncate&#39;</span>,
<a name="l01523"></a>01523                 <span class="stringliteral">&#39;describe_splits&#39;</span>
<a name="l01524"></a>01524             );
<a name="l01525"></a>01525         }
<a name="l01526"></a>01526         
<a name="l01527"></a>01527         <span class="keywordflow">return</span> self::$keyspaceRequiredMethods;
<a name="l01528"></a>01528     }
<a name="l01529"></a>01529 
<a name="l01536"></a><a class="code" href="classCassandra.html#a960d23553468532df3d4c6bf712bb2f7">01536</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandra.html#a960d23553468532df3d4c6bf712bb2f7">parseRequest</a>($request) {
<a name="l01537"></a>01537         <span class="keywordflow">foreach</span>(self::$requestKeyTokens as $tokenKey =&gt; $keyToken) {
<a name="l01538"></a>01538             $request = str_replace(
<a name="l01539"></a>01539                 <span class="charliteral">&#39;\\&#39;</span>.$keyToken,
<a name="l01540"></a>01540                 <span class="stringliteral">&#39;[/&#39;</span>.$tokenKey.<span class="stringliteral">&#39;\\]&#39;</span>,
<a name="l01541"></a>01541                 $request
<a name="l01542"></a>01542             );
<a name="l01543"></a>01543         }
<a name="l01544"></a>01544         
<a name="l01545"></a>01545         $components = array();
<a name="l01546"></a>01546         
<a name="l01547"></a>01547         $matchSuccessful = preg_match(
<a name="l01548"></a>01548             <span class="stringliteral">&#39;/^(.+)\.(.+)((\.(.*))|\[\])?(:(.*))?(\|(\d*)(R)?)?$/U&#39;</span>,
<a name="l01549"></a>01549             <span class="comment">// 1     2   34  5           6 7     8  9    10        </span>
<a name="l01550"></a>01550             $request,
<a name="l01551"></a>01551             $components
<a name="l01552"></a>01552         );
<a name="l01553"></a>01553 
<a name="l01554"></a>01554         <span class="keywordflow">if</span> (!$matchSuccessful || empty($components)) {
<a name="l01555"></a>01555             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidPatternException.html">CassandraInvalidPatternException</a>(
<a name="l01556"></a>01556                 <span class="stringliteral">&#39;Invalid get request &quot;&#39;</span>.$request.<span class="stringliteral">&#39;&quot; provided&#39;</span>
<a name="l01557"></a>01557             );
<a name="l01558"></a>01558         }
<a name="l01559"></a>01559 
<a name="l01560"></a>01560         $result = array(
<a name="l01561"></a>01561             <span class="stringliteral">&#39;column-family&#39;</span> =&gt; $components[1],
<a name="l01562"></a>01562             <span class="stringliteral">&#39;key&#39;</span> =&gt; $components[2],
<a name="l01563"></a>01563             <span class="stringliteral">&#39;columns&#39;</span> =&gt; null,
<a name="l01564"></a>01564             <span class="stringliteral">&#39;start-column&#39;</span> =&gt; null,
<a name="l01565"></a>01565             <span class="stringliteral">&#39;end-column&#39;</span> =&gt; null,
<a name="l01566"></a>01566             <span class="stringliteral">&#39;reversed&#39;</span> =&gt; <span class="keyword">false</span>,
<a name="l01567"></a>01567             <span class="stringliteral">&#39;column-count&#39;</span> =&gt; $this-&gt;defaultColumnCount,
<a name="l01568"></a>01568             <span class="stringliteral">&#39;super-column&#39;</span> =&gt; null
<a name="l01569"></a>01569         );
<a name="l01570"></a>01570         
<a name="l01571"></a>01571         $componentCount = count($components);
<a name="l01572"></a>01572         
<a name="l01573"></a>01573         <span class="comment">// @codeCoverageIgnoreStart</span>
<a name="l01574"></a>01574         <span class="keywordflow">if</span> ($componentCount &lt; 3 || $componentCount &gt; 11) {
<a name="l01575"></a>01575             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidPatternException.html">CassandraInvalidPatternException</a>(
<a name="l01576"></a>01576                 <span class="stringliteral">&#39;Invalid pattern, expected between 3 and 11 components, got &#39;</span>.
<a name="l01577"></a>01577                 $componentCount.<span class="stringliteral">&#39;, this should not happen&#39;</span>
<a name="l01578"></a>01578             );
<a name="l01579"></a>01579         }
<a name="l01580"></a>01580         <span class="comment">// @codeCoverageIgnoreEnd</span>
<a name="l01581"></a>01581         
<a name="l01582"></a>01582         <span class="keywordflow">if</span> ($componentCount &gt;= 6) {
<a name="l01583"></a>01583             <span class="keywordflow">if</span> (
<a name="l01584"></a>01584                 !empty($components[5])
<a name="l01585"></a>01585                 &amp;&amp; $components[5] != <span class="stringliteral">&#39;[]&#39;</span>
<a name="l01586"></a>01586             ) {
<a name="l01587"></a>01587                 $result[<span class="stringliteral">&#39;super-column&#39;</span>] = $components[5];
<a name="l01588"></a>01588             }
<a name="l01589"></a>01589             
<a name="l01590"></a>01590             <span class="keywordflow">if</span> ($componentCount &gt;= 8) {
<a name="l01591"></a>01591                 <span class="keywordflow">if</span> (!empty($components[7])) {
<a name="l01592"></a>01592                     <span class="keywordflow">if</span> (strpos($components[7], <span class="charliteral">&#39;,&#39;</span>) !== <span class="keyword">false</span>) {
<a name="l01593"></a>01593                         $columns = explode(<span class="charliteral">&#39;,&#39;</span>, $components[7]);
<a name="l01594"></a>01594 
<a name="l01595"></a>01595                         <span class="keywordflow">foreach</span> ($columns as $columnIndex =&gt; $columnName) {
<a name="l01596"></a>01596                             $columns[$columnIndex] = trim($columnName);
<a name="l01597"></a>01597                         }
<a name="l01598"></a>01598 
<a name="l01599"></a>01599                         $result[<span class="stringliteral">&#39;columns&#39;</span>] = $columns;
<a name="l01600"></a>01600                     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strpos($components[7], <span class="charliteral">&#39;-&#39;</span>) !== <span class="keyword">false</span>) {
<a name="l01601"></a>01601                         $rangeColumns = explode(<span class="charliteral">&#39;-&#39;</span>, $components[7]);
<a name="l01602"></a>01602 
<a name="l01603"></a>01603                         <span class="keywordflow">if</span> (count($rangeColumns) &gt; 2) {
<a name="l01604"></a>01604                             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidPatternException.html">CassandraInvalidPatternException</a>(
<a name="l01605"></a>01605                                 <span class="stringliteral">&#39;Expected no more than 2 columns &#39;</span>.
<a name="l01606"></a>01606                                 <span class="stringliteral">&#39;to define a range&#39;</span>
<a name="l01607"></a>01607                             );
<a name="l01608"></a>01608                         }
<a name="l01609"></a>01609 
<a name="l01610"></a>01610                         $result[<span class="stringliteral">&#39;start-column&#39;</span>] = trim($rangeColumns[0]);
<a name="l01611"></a>01611                         $result[<span class="stringliteral">&#39;end-column&#39;</span>] = trim($rangeColumns[1]);
<a name="l01612"></a>01612                     } <span class="keywordflow">else</span> {
<a name="l01613"></a>01613                         $result[<span class="stringliteral">&#39;columns&#39;</span>] = array(trim($components[7]));
<a name="l01614"></a>01614                     }
<a name="l01615"></a>01615                 }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617                 <span class="keywordflow">if</span> ($componentCount &gt;= 10 &amp;&amp; !empty($components[9])) {
<a name="l01618"></a>01618                     $columnCount = (int)$components[9];
<a name="l01619"></a>01619 
<a name="l01620"></a>01620                     $result[<span class="stringliteral">&#39;column-count&#39;</span>] = $columnCount;
<a name="l01621"></a>01621                 }
<a name="l01622"></a>01622 
<a name="l01623"></a>01623                 <span class="keywordflow">if</span> (
<a name="l01624"></a>01624                     $componentCount == 11
<a name="l01625"></a>01625                     &amp;&amp; strtoupper($components[10]) == <span class="charliteral">&#39;R&#39;</span>
<a name="l01626"></a>01626                 ) {
<a name="l01627"></a>01627                     $result[<span class="stringliteral">&#39;reversed&#39;</span>] = <span class="keyword">true</span>;
<a name="l01628"></a>01628                 }
<a name="l01629"></a>01629             }
<a name="l01630"></a>01630         }
<a name="l01631"></a>01631         
<a name="l01632"></a>01632         <span class="keywordflow">foreach</span> ($result as $key =&gt; $item) {
<a name="l01633"></a>01633             $result[$key] = <a class="code" href="classCassandra.html#add4a1aed054f96ad74938e149b0ed0ef">self::unescape</a>($item);
<a name="l01634"></a>01634         }
<a name="l01635"></a>01635     
<a name="l01636"></a>01636         <span class="keywordflow">return</span> $result;
<a name="l01637"></a>01637     }
<a name="l01638"></a>01638     
<a name="l01645"></a><a class="code" href="classCassandra.html#add0d5cd1c9ce26092db0124971e39d11">01645</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandra.html#add0d5cd1c9ce26092db0124971e39d11">escape</a>($value) {
<a name="l01646"></a>01646         <span class="keywordflow">foreach</span>(self::$requestKeyTokens as $keyToken) {
<a name="l01647"></a>01647             $value = str_replace(
<a name="l01648"></a>01648                 $keyToken,
<a name="l01649"></a>01649                 <span class="charliteral">&#39;\\&#39;</span>.$keyToken,
<a name="l01650"></a>01650                 $value
<a name="l01651"></a>01651             );
<a name="l01652"></a>01652         }
<a name="l01653"></a>01653         
<a name="l01654"></a>01654         <span class="keywordflow">return</span> $value;
<a name="l01655"></a>01655     }
<a name="l01656"></a>01656     
<a name="l01663"></a><a class="code" href="classCassandra.html#add4a1aed054f96ad74938e149b0ed0ef">01663</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandra.html#add4a1aed054f96ad74938e149b0ed0ef">unescape</a>($value) {
<a name="l01664"></a>01664         <span class="keywordflow">if</span> (empty($value)) {
<a name="l01665"></a>01665             <span class="keywordflow">return</span> $value;
<a name="l01666"></a>01666         }
<a name="l01667"></a>01667         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_array($value)) {
<a name="l01668"></a>01668             <span class="keywordflow">foreach</span> ($value as $key =&gt; $item) {
<a name="l01669"></a>01669                 $value[$key] = <a class="code" href="classCassandra.html#add4a1aed054f96ad74938e149b0ed0ef">self::unescape</a>($item);
<a name="l01670"></a>01670             }
<a name="l01671"></a>01671         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is_string($value)) {
<a name="l01672"></a>01672             <span class="keywordflow">foreach</span>(self::$requestKeyTokens as $tokenKey =&gt; $keyToken) {
<a name="l01673"></a>01673                 $value = str_replace(
<a name="l01674"></a>01674                     <span class="stringliteral">&#39;[/&#39;</span>.$tokenKey.<span class="stringliteral">&#39;\\]&#39;</span>,
<a name="l01675"></a>01675                     $keyToken,
<a name="l01676"></a>01676                     $value
<a name="l01677"></a>01677                 );
<a name="l01678"></a>01678             }
<a name="l01679"></a>01679         }
<a name="l01680"></a>01680         
<a name="l01681"></a>01681         <span class="keywordflow">return</span> $value;
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683     
<a name="l01690"></a><a class="code" href="classCassandra.html#a48c9d0cb51ea0ac56949b7865760ed5e">01690</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandra.html#a48c9d0cb51ea0ac56949b7865760ed5e">createColumnDefinition</a>(array $info) {
<a name="l01691"></a>01691         $def = <span class="keyword">new</span> cassandra_ColumnDef();
<a name="l01692"></a>01692 
<a name="l01693"></a>01693         $def-&gt;name = $info[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l01694"></a>01694         
<a name="l01695"></a>01695         <span class="keywordflow">if</span> (!empty($info[<span class="stringliteral">&#39;type&#39;</span>])) {
<a name="l01696"></a>01696             $def-&gt;validation_class = $info[<span class="stringliteral">&#39;type&#39;</span>];
<a name="l01697"></a>01697         }
<a name="l01698"></a>01698         
<a name="l01699"></a>01699         <span class="keywordflow">if</span> (isset($info[<span class="stringliteral">&#39;index-type&#39;</span>])) {
<a name="l01700"></a>01700             $def-&gt;index_type = $info[<span class="stringliteral">&#39;index-type&#39;</span>];
<a name="l01701"></a>01701         }
<a name="l01702"></a>01702         
<a name="l01703"></a>01703         <span class="keywordflow">if</span> (!empty($info[<span class="stringliteral">&#39;index-name&#39;</span>])) {
<a name="l01704"></a>01704             $def-&gt;index_type = $info[<span class="stringliteral">&#39;index-name&#39;</span>];
<a name="l01705"></a>01705         }
<a name="l01706"></a>01706         
<a name="l01707"></a>01707         <span class="keywordflow">return</span> $def;
<a name="l01708"></a>01708     }
<a name="l01709"></a>01709 }
<a name="l01710"></a>01710 
<a name="l01720"></a><a class="code" href="classCassandraColumnFamily.html">01720</a> <span class="keyword">class </span><a class="code" href="classCassandraColumnFamily.html">CassandraColumnFamily</a> {
<a name="l01721"></a>01721     
<a name="l01727"></a>01727     <span class="keyword">protected</span> $cassandra;
<a name="l01728"></a>01728     
<a name="l01734"></a>01734     <span class="keyword">protected</span> $name;
<a name="l01735"></a>01735     
<a name="l01743"></a>01743     <span class="keyword">protected</span> $defaultReadConsistency;
<a name="l01744"></a>01744     
<a name="l01752"></a>01752     <span class="keyword">protected</span> $defaultWriteConsistency;
<a name="l01753"></a>01753     
<a name="l01759"></a>01759     <span class="keyword">protected</span> $autopack;
<a name="l01760"></a>01760     
<a name="l01768"></a>01768     <span class="keyword">protected</span> $schema;
<a name="l01769"></a>01769     
<a name="l01783"></a><a class="code" href="classCassandraColumnFamily.html#a1b091f156f08bc69f16ff20a7faae39f">01783</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a1b091f156f08bc69f16ff20a7faae39f">__construct</a>(
<a name="l01784"></a>01784         <a class="code" href="classCassandra.html">Cassandra</a> $cassandra,
<a name="l01785"></a>01785         $name,
<a name="l01786"></a>01786         $defaultReadConsistency = <a class="code" href="classCassandra.html#afd35e5b7419ce2915891c349a44b6f22">Cassandra::CONSISTENCY_ONE</a>,
<a name="l01787"></a>01787         $defaultWriteConsistency = <a class="code" href="classCassandra.html#afd35e5b7419ce2915891c349a44b6f22">Cassandra::CONSISTENCY_ONE</a>,
<a name="l01788"></a>01788         $autopack = <span class="keyword">true</span>
<a name="l01789"></a>01789     ) {
<a name="l01790"></a>01790         $this-&gt;cassandra = $cassandra;
<a name="l01791"></a>01791         $this-&gt;name = $name;
<a name="l01792"></a>01792         $this-&gt;defaultReadConsistency = $defaultReadConsistency;
<a name="l01793"></a>01793         $this-&gt;defaultWriteConsistency = $defaultWriteConsistency;
<a name="l01794"></a>01794         $this-&gt;autopack = $autopack;
<a name="l01795"></a>01795         $this-&gt;schema = null;
<a name="l01796"></a>01796     }
<a name="l01797"></a>01797     
<a name="l01803"></a><a class="code" href="classCassandraColumnFamily.html#a000c9f902dd0a2b7577608b31aaa0085">01803</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a000c9f902dd0a2b7577608b31aaa0085">getCassandra</a>() {
<a name="l01804"></a>01804         <span class="keywordflow">return</span> $this-&gt;cassandra;
<a name="l01805"></a>01805     }
<a name="l01806"></a>01806     
<a name="l01814"></a><a class="code" href="classCassandraColumnFamily.html#aa5e0d45507ac78641f7df1d0fc7845fd">01814</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#aa5e0d45507ac78641f7df1d0fc7845fd">getSchema</a>($useCache = <span class="keyword">true</span>) {
<a name="l01815"></a>01815         <span class="keywordflow">if</span> ($this-&gt;schema === null) {
<a name="l01816"></a>01816             $keyspaceSchema = $this-&gt;cassandra-&gt;getKeyspaceSchema(
<a name="l01817"></a>01817                 null,
<a name="l01818"></a>01818                 $useCache
<a name="l01819"></a>01819             );
<a name="l01820"></a>01820 
<a name="l01821"></a>01821             <span class="keywordflow">if</span> (!isset($keyspaceSchema[<span class="stringliteral">&#39;column-families&#39;</span>][$this-&gt;name])) {
<a name="l01822"></a>01822                 <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraColumnFamilyNotFoundException.html">CassandraColumnFamilyNotFoundException</a>(
<a name="l01823"></a>01823                     <span class="stringliteral">&#39;Schema for column family &quot;&#39;</span>.$this-&gt;name.<span class="stringliteral">&#39;&quot; not found&#39;</span>
<a name="l01824"></a>01824                 );
<a name="l01825"></a>01825             }
<a name="l01826"></a>01826             
<a name="l01827"></a>01827             $this-&gt;schema = $keyspaceSchema[<span class="stringliteral">&#39;column-families&#39;</span>][$this-&gt;name];
<a name="l01828"></a>01828         }
<a name="l01829"></a>01829         
<a name="l01830"></a>01830         <span class="keywordflow">return</span> $this-&gt;schema;
<a name="l01831"></a>01831     }
<a name="l01832"></a>01832     
<a name="l01842"></a><a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">01842</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>($useCache = <span class="keyword">true</span>) {
<a name="l01843"></a>01843         $schema = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa5e0d45507ac78641f7df1d0fc7845fd">getSchema</a>($useCache);
<a name="l01844"></a>01844         
<a name="l01845"></a>01845         <span class="keywordflow">if</span> ($schema[<span class="stringliteral">&#39;super&#39;</span>]) {
<a name="l01846"></a>01846             <span class="keywordflow">return</span> $schema[<span class="stringliteral">&#39;super-type&#39;</span>];
<a name="l01847"></a>01847         } <span class="keywordflow">else</span> {
<a name="l01848"></a>01848             <span class="keywordflow">return</span> $schema[<span class="stringliteral">&#39;column-type&#39;</span>];
<a name="l01849"></a>01849         }
<a name="l01850"></a>01850     }
<a name="l01851"></a>01851     
<a name="l01862"></a><a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">01862</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">getColumnValueType</a>($columnName, $useCache = <span class="keyword">true</span>) {
<a name="l01863"></a>01863         $schema = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa5e0d45507ac78641f7df1d0fc7845fd">getSchema</a>($useCache);
<a name="l01864"></a>01864             
<a name="l01865"></a>01865         <span class="keywordflow">if</span> (isset($schema[<span class="stringliteral">&#39;column-data-types&#39;</span>][$columnName])) {
<a name="l01866"></a>01866             <span class="keywordflow">return</span> $schema[<span class="stringliteral">&#39;column-data-types&#39;</span>][$columnName];
<a name="l01867"></a>01867         }
<a name="l01868"></a>01868         
<a name="l01869"></a>01869         <span class="keywordflow">return</span> <a class="code" href="classCassandra.html#ab75de9aa0588c7665f1c9d8cf8d4e8ff">Cassandra::TYPE_BYTES</a>;
<a name="l01870"></a>01870     }
<a name="l01871"></a>01871     
<a name="l01884"></a><a class="code" href="classCassandraColumnFamily.html#a6bb5aa6148e8350990c1a61021974470">01884</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a6bb5aa6148e8350990c1a61021974470">getAll</a>($key, $superColumn = null, $consistency = null) {
<a name="l01885"></a>01885         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(
<a name="l01886"></a>01886             $key,
<a name="l01887"></a>01887             null,
<a name="l01888"></a>01888             null,
<a name="l01889"></a>01889             null,
<a name="l01890"></a>01890             <span class="keyword">false</span>,
<a name="l01891"></a>01891             100,
<a name="l01892"></a>01892             $superColumn,
<a name="l01893"></a>01893             $consistency
<a name="l01894"></a>01894         );
<a name="l01895"></a>01895     }
<a name="l01896"></a>01896     
<a name="l01910"></a><a class="code" href="classCassandraColumnFamily.html#a06bfbe9d4a44eb9c8b08037ed3b96494">01910</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a06bfbe9d4a44eb9c8b08037ed3b96494">getColumns</a>(
<a name="l01911"></a>01911         $key,
<a name="l01912"></a>01912         array $columns,
<a name="l01913"></a>01913         $superColumn = null,
<a name="l01914"></a>01914         $consistency = null
<a name="l01915"></a>01915     ) {
<a name="l01916"></a>01916         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(
<a name="l01917"></a>01917             $key,
<a name="l01918"></a>01918             $columns,
<a name="l01919"></a>01919             null,
<a name="l01920"></a>01920             null,
<a name="l01921"></a>01921             <span class="keyword">false</span>,
<a name="l01922"></a>01922             100,
<a name="l01923"></a>01923             $superColumn,
<a name="l01924"></a>01924             $consistency
<a name="l01925"></a>01925         );
<a name="l01926"></a>01926     }
<a name="l01927"></a>01927     
<a name="l01946"></a><a class="code" href="classCassandraColumnFamily.html#abd1ec26e68a338f18ef1da088574366e">01946</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#abd1ec26e68a338f18ef1da088574366e">getColumnRange</a>(
<a name="l01947"></a>01947         $key,
<a name="l01948"></a>01948         $startColumn,
<a name="l01949"></a>01949         $endColumn,
<a name="l01950"></a>01950         $superColumn = null,
<a name="l01951"></a>01951         $columnCount = 100,
<a name="l01952"></a>01952         $consistency = null
<a name="l01953"></a>01953     ) {
<a name="l01954"></a>01954         <span class="keywordflow">return</span> $this-&gt;<span class="keyword">get</span>(
<a name="l01955"></a>01955             $key,
<a name="l01956"></a>01956             null,
<a name="l01957"></a>01957             $startColumn,
<a name="l01958"></a>01958             $endColumn,
<a name="l01959"></a>01959             <span class="keyword">false</span>,
<a name="l01960"></a>01960             $columnCount,
<a name="l01961"></a>01961             $superColumn,
<a name="l01962"></a>01962             $consistency
<a name="l01963"></a>01963         );
<a name="l01964"></a>01964     }
<a name="l01965"></a>01965     
<a name="l01994"></a><a class="code" href="classCassandraColumnFamily.html#a0ae94f62112a09cfa34ad55b7c3cc641">01994</a>     <span class="keyword">public</span> function <span class="keyword">get</span>(
<a name="l01995"></a>01995         $key,
<a name="l01996"></a>01996         $columns = null,
<a name="l01997"></a>01997         $startColumn = null,
<a name="l01998"></a>01998         $endColumn = null,
<a name="l01999"></a>01999         $columnsReversed = <span class="keyword">false</span>,
<a name="l02000"></a>02000         $columnCount = 100,
<a name="l02001"></a>02001         $superColumn = null,
<a name="l02002"></a>02002         $consistency = null
<a name="l02003"></a>02003     ) {
<a name="l02004"></a>02004         <span class="keywordflow">if</span> ($columns !== null &amp;&amp; $startColumn !== null) {
<a name="l02005"></a>02005             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l02006"></a>02006                 <span class="stringliteral">&#39;You can define either a list of columns or the start and end &#39;</span>.
<a name="l02007"></a>02007                 <span class="stringliteral">&#39;columns for a range but not both at the same time&#39;</span>
<a name="l02008"></a>02008             );
<a name="l02009"></a>02009         }
<a name="l02010"></a>02010         
<a name="l02011"></a>02011         <span class="keywordflow">if</span> ($consistency === null) {
<a name="l02012"></a>02012             $consistency = $this-&gt;defaultReadConsistency;
<a name="l02013"></a>02013         }
<a name="l02014"></a>02014         
<a name="l02015"></a>02015         $columnParent = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">createColumnParent</a>($superColumn);
<a name="l02016"></a>02016 
<a name="l02017"></a>02017         $slicePredicate = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">createSlicePredicate</a>(
<a name="l02018"></a>02018             $columns,
<a name="l02019"></a>02019             $startColumn,
<a name="l02020"></a>02020             $endColumn,
<a name="l02021"></a>02021             $columnsReversed,
<a name="l02022"></a>02022             $columnCount
<a name="l02023"></a>02023         );
<a name="l02024"></a>02024         
<a name="l02025"></a>02025         $result = $this-&gt;cassandra-&gt;call(
<a name="l02026"></a>02026             <span class="stringliteral">&#39;get_slice&#39;</span>,
<a name="l02027"></a>02027             $key,
<a name="l02028"></a>02028             $columnParent,
<a name="l02029"></a>02029             $slicePredicate,
<a name="l02030"></a>02030             $consistency
<a name="l02031"></a>02031         );
<a name="l02032"></a>02032                 
<a name="l02033"></a>02033         <span class="keywordflow">if</span> (count($result) == 0) {
<a name="l02034"></a>02034             <span class="keywordflow">return</span> null;
<a name="l02035"></a>02035         }
<a name="l02036"></a>02036         
<a name="l02037"></a>02037         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a10f09668871103443fbbe9f6747a95f8">parseSliceResponse</a>($result);
<a name="l02038"></a>02038     }
<a name="l02039"></a>02039     
<a name="l02077"></a><a class="code" href="classCassandraColumnFamily.html#a70850301cfaf85c4c170453a8aaeab9b">02077</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a70850301cfaf85c4c170453a8aaeab9b">getWhere</a>(
<a name="l02078"></a>02078         array $where,
<a name="l02079"></a>02079         $columns = null,
<a name="l02080"></a>02080         $startColumn = null,
<a name="l02081"></a>02081         $endColumn = null,
<a name="l02082"></a>02082         $columnsReversed = <span class="keyword">false</span>,
<a name="l02083"></a>02083         $rowCountLimit = null,
<a name="l02084"></a>02084         $columnCount = 100,
<a name="l02085"></a>02085         $superColumn = null,
<a name="l02086"></a>02086         $consistency = null,
<a name="l02087"></a>02087         $bufferSize = 1000
<a name="l02088"></a>02088     ) {
<a name="l02089"></a>02089         <span class="keywordflow">if</span> ($columns !== null &amp;&amp; $startColumn !== null) {
<a name="l02090"></a>02090             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l02091"></a>02091                 <span class="stringliteral">&#39;You can define either a list of columns or the start and end &#39;</span>.
<a name="l02092"></a>02092                 <span class="stringliteral">&#39;columns for a range but not both at the same time&#39;</span>
<a name="l02093"></a>02093             );
<a name="l02094"></a>02094         }
<a name="l02095"></a>02095         
<a name="l02096"></a>02096         <span class="keywordflow">if</span> ($consistency === null) {
<a name="l02097"></a>02097             $consistency = $this-&gt;defaultReadConsistency;
<a name="l02098"></a>02098         }
<a name="l02099"></a>02099         
<a name="l02100"></a>02100         $columnParent = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">createColumnParent</a>($superColumn);
<a name="l02101"></a>02101 
<a name="l02102"></a>02102         $slicePredicate = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">createSlicePredicate</a>(
<a name="l02103"></a>02103             $columns,
<a name="l02104"></a>02104             $startColumn,
<a name="l02105"></a>02105             $endColumn,
<a name="l02106"></a>02106             $columnsReversed,
<a name="l02107"></a>02107             $columnCount
<a name="l02108"></a>02108         );
<a name="l02109"></a>02109         
<a name="l02110"></a>02110         $indexClause = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a7996d424367e08607847f14f93006cb6">createIndexClause</a>(
<a name="l02111"></a>02111             $where,
<a name="l02112"></a>02112             $startColumn,
<a name="l02113"></a>02113             $columnCount
<a name="l02114"></a>02114         );
<a name="l02115"></a>02115         
<a name="l02116"></a>02116         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classCassandraIndexedDataIterator.html">CassandraIndexedDataIterator</a>(
<a name="l02117"></a>02117             $this,
<a name="l02118"></a>02118             $columnParent,
<a name="l02119"></a>02119             $indexClause,
<a name="l02120"></a>02120             $slicePredicate,
<a name="l02121"></a>02121             $consistency,
<a name="l02122"></a>02122             $rowCountLimit,
<a name="l02123"></a>02123             $bufferSize
<a name="l02124"></a>02124         );
<a name="l02125"></a>02125     }
<a name="l02126"></a>02126     
<a name="l02154"></a><a class="code" href="classCassandraColumnFamily.html#ac8ac7a1d976bd196678b6985cc93be43">02154</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#ac8ac7a1d976bd196678b6985cc93be43">getMultiple</a>(
<a name="l02155"></a>02155         array $keys,
<a name="l02156"></a>02156         $columns = null,
<a name="l02157"></a>02157         $startColumn = null,
<a name="l02158"></a>02158         $endColumn = null,
<a name="l02159"></a>02159         $columnsReversed = <span class="keyword">false</span>,
<a name="l02160"></a>02160         $columnCount = 100,
<a name="l02161"></a>02161         $superColumn = null,
<a name="l02162"></a>02162         $consistency = null,
<a name="l02163"></a>02163         $bufferSize = 512
<a name="l02164"></a>02164     ) {
<a name="l02165"></a>02165         <span class="keywordflow">if</span> ($columns !== null &amp;&amp; $startColumn !== null) {
<a name="l02166"></a>02166             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l02167"></a>02167                 <span class="stringliteral">&#39;You can define either a list of columns or the start and end &#39;</span>.
<a name="l02168"></a>02168                 <span class="stringliteral">&#39;columns for a range but not both at the same time&#39;</span>
<a name="l02169"></a>02169             );
<a name="l02170"></a>02170         }
<a name="l02171"></a>02171         
<a name="l02172"></a>02172         <span class="keywordflow">if</span> ($consistency === null) {
<a name="l02173"></a>02173             $consistency = $this-&gt;defaultReadConsistency;
<a name="l02174"></a>02174         }
<a name="l02175"></a>02175         
<a name="l02176"></a>02176         $columnParent = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">createColumnParent</a>($superColumn);
<a name="l02177"></a>02177 
<a name="l02178"></a>02178         $slicePredicate = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">createSlicePredicate</a>(
<a name="l02179"></a>02179             $columns,
<a name="l02180"></a>02180             $startColumn,
<a name="l02181"></a>02181             $endColumn,
<a name="l02182"></a>02182             $columnsReversed,
<a name="l02183"></a>02183             $columnCount
<a name="l02184"></a>02184         );
<a name="l02185"></a>02185         
<a name="l02186"></a>02186         $results = array();
<a name="l02187"></a>02187         $responses = array();
<a name="l02188"></a>02188         
<a name="l02189"></a>02189         <span class="keywordflow">foreach</span> ($keys as $key) {
<a name="l02190"></a>02190             $results[$key] = null;
<a name="l02191"></a>02191         }
<a name="l02192"></a>02192         
<a name="l02193"></a>02193         $keyCount = count($keys);
<a name="l02194"></a>02194         $setCount = ceil($keyCount / $bufferSize);
<a name="l02195"></a>02195         
<a name="l02196"></a>02196         <span class="keywordflow">for</span> ($i = 0; $i &lt; $setCount; $i++) {
<a name="l02197"></a>02197             $setKeys = array_slice($keys, $i * $bufferSize, $bufferSize);
<a name="l02198"></a>02198             
<a name="l02199"></a>02199             $setResponse = $this-&gt;cassandra-&gt;call(
<a name="l02200"></a>02200                 <span class="stringliteral">&#39;multiget_slice&#39;</span>,
<a name="l02201"></a>02201                 $setKeys,
<a name="l02202"></a>02202                 $columnParent,
<a name="l02203"></a>02203                 $slicePredicate,
<a name="l02204"></a>02204                 $consistency
<a name="l02205"></a>02205             );
<a name="l02206"></a>02206 
<a name="l02207"></a>02207             $responses = array_merge($responses, $setResponse);
<a name="l02208"></a>02208         }
<a name="l02209"></a>02209 
<a name="l02210"></a>02210         <span class="keywordflow">foreach</span> ($responses as $key =&gt; $response) {
<a name="l02211"></a>02211             $results[$key] = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a10f09668871103443fbbe9f6747a95f8">parseSliceResponse</a>($response);
<a name="l02212"></a>02212         }
<a name="l02213"></a>02213 
<a name="l02214"></a>02214         <span class="keywordflow">return</span> $results;
<a name="l02215"></a>02215     }
<a name="l02216"></a>02216     
<a name="l02255"></a><a class="code" href="classCassandraColumnFamily.html#a327a88ea26f58c75de804a82a2087935">02255</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a327a88ea26f58c75de804a82a2087935">getKeyRange</a>(
<a name="l02256"></a>02256         $startKey = null,
<a name="l02257"></a>02257         $endKey = null,
<a name="l02258"></a>02258         $rowCountLimit = null,
<a name="l02259"></a>02259         $columns = null,
<a name="l02260"></a>02260         $startColumn = null,
<a name="l02261"></a>02261         $endColumn = null,
<a name="l02262"></a>02262         $columnsReversed = <span class="keyword">false</span>,
<a name="l02263"></a>02263         $columnCount = 100,
<a name="l02264"></a>02264         $superColumn = null,
<a name="l02265"></a>02265         $consistency = null,
<a name="l02266"></a>02266         $bufferSize = 512
<a name="l02267"></a>02267     ) {
<a name="l02268"></a>02268         <span class="keywordflow">if</span> ($columns !== null &amp;&amp; $startColumn !== null) {
<a name="l02269"></a>02269             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l02270"></a>02270                 <span class="stringliteral">&#39;You can define either a list of columns or the start and end &#39;</span>.
<a name="l02271"></a>02271                 <span class="stringliteral">&#39;columns for a range but not both at the same time&#39;</span>
<a name="l02272"></a>02272             );
<a name="l02273"></a>02273         }
<a name="l02274"></a>02274         
<a name="l02275"></a>02275         <span class="keywordflow">if</span> ($consistency === null) {
<a name="l02276"></a>02276             $consistency = $this-&gt;defaultReadConsistency;
<a name="l02277"></a>02277         }
<a name="l02278"></a>02278         
<a name="l02279"></a>02279         <span class="keywordflow">if</span> ($startKey === null) {
<a name="l02280"></a>02280             $startKey = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02281"></a>02281         }
<a name="l02282"></a>02282         
<a name="l02283"></a>02283         <span class="keywordflow">if</span> ($endKey === null) {
<a name="l02284"></a>02284             $endKey = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02285"></a>02285         }
<a name="l02286"></a>02286         
<a name="l02287"></a>02287         $columnParent = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">createColumnParent</a>($superColumn);
<a name="l02288"></a>02288 
<a name="l02289"></a>02289         $slicePredicate = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">createSlicePredicate</a>(
<a name="l02290"></a>02290             $columns,
<a name="l02291"></a>02291             $startColumn,
<a name="l02292"></a>02292             $endColumn,
<a name="l02293"></a>02293             $columnsReversed,
<a name="l02294"></a>02294             $columnCount
<a name="l02295"></a>02295         );
<a name="l02296"></a>02296         
<a name="l02297"></a>02297         <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="classCassandraRangeDataIterator.html">CassandraRangeDataIterator</a>(
<a name="l02298"></a>02298             $this,
<a name="l02299"></a>02299             $columnParent,
<a name="l02300"></a>02300             $slicePredicate,
<a name="l02301"></a>02301             $startKey,
<a name="l02302"></a>02302             $endKey,
<a name="l02303"></a>02303             $consistency,
<a name="l02304"></a>02304             $rowCountLimit,
<a name="l02305"></a>02305             $bufferSize
<a name="l02306"></a>02306         );
<a name="l02307"></a>02307     }
<a name="l02308"></a>02308     
<a name="l02322"></a><a class="code" href="classCassandraColumnFamily.html#acf742fffdda67cc5e94e984b07def395">02322</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#acf742fffdda67cc5e94e984b07def395">getColumnCount</a>(
<a name="l02323"></a>02323         $key,
<a name="l02324"></a>02324         $columns = null,
<a name="l02325"></a>02325         $startColumn = null,
<a name="l02326"></a>02326         $endColumn = null,
<a name="l02327"></a>02327         $superColumn = null,
<a name="l02328"></a>02328         $consistency = null 
<a name="l02329"></a>02329     ) {
<a name="l02330"></a>02330         <span class="keywordflow">if</span> ($columns !== null &amp;&amp; $startColumn !== null) {
<a name="l02331"></a>02331             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l02332"></a>02332                 <span class="stringliteral">&#39;You can define either a list of columns or the start and end &#39;</span>.
<a name="l02333"></a>02333                 <span class="stringliteral">&#39;columns for a range but not both at the same time&#39;</span>
<a name="l02334"></a>02334             );
<a name="l02335"></a>02335         }
<a name="l02336"></a>02336         
<a name="l02337"></a>02337         <span class="keywordflow">if</span> ($consistency === null) {
<a name="l02338"></a>02338             $consistency = $this-&gt;defaultReadConsistency;
<a name="l02339"></a>02339         }
<a name="l02340"></a>02340         
<a name="l02341"></a>02341         $columnParent = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">createColumnParent</a>($superColumn);
<a name="l02342"></a>02342 
<a name="l02343"></a>02343         $slicePredicate = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">createSlicePredicate</a>(
<a name="l02344"></a>02344             $columns,
<a name="l02345"></a>02345             $startColumn,
<a name="l02346"></a>02346             $endColumn,
<a name="l02347"></a>02347             <span class="keyword">false</span>,
<a name="l02348"></a>02348             2147483647
<a name="l02349"></a>02349         );
<a name="l02350"></a>02350 
<a name="l02351"></a>02351         <span class="keywordflow">return</span> $this-&gt;cassandra-&gt;call(
<a name="l02352"></a>02352             <span class="stringliteral">&#39;get_count&#39;</span>,
<a name="l02353"></a>02353             $key,
<a name="l02354"></a>02354             $columnParent,
<a name="l02355"></a>02355             $slicePredicate,
<a name="l02356"></a>02356             $consistency
<a name="l02357"></a>02357         );
<a name="l02358"></a>02358     }
<a name="l02359"></a>02359     
<a name="l02373"></a><a class="code" href="classCassandraColumnFamily.html#a3b2f42e92f480eb254a331431208bd55">02373</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a3b2f42e92f480eb254a331431208bd55">getColumnCounts</a>(
<a name="l02374"></a>02374         array $keys,
<a name="l02375"></a>02375         $columns = null,
<a name="l02376"></a>02376         $startColumn = null,
<a name="l02377"></a>02377         $endColumn = null,
<a name="l02378"></a>02378         $superColumn = null,
<a name="l02379"></a>02379         $consistency = null 
<a name="l02380"></a>02380     ) {
<a name="l02381"></a>02381         <span class="keywordflow">if</span> ($columns !== null &amp;&amp; $startColumn !== null) {
<a name="l02382"></a>02382             <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l02383"></a>02383                 <span class="stringliteral">&#39;You can define either a list of columns or the start and end &#39;</span>.
<a name="l02384"></a>02384                 <span class="stringliteral">&#39;columns for a range but not both at the same time&#39;</span>
<a name="l02385"></a>02385             );
<a name="l02386"></a>02386         }
<a name="l02387"></a>02387         
<a name="l02388"></a>02388         <span class="keywordflow">if</span> ($consistency === null) {
<a name="l02389"></a>02389             $consistency = $this-&gt;defaultReadConsistency;
<a name="l02390"></a>02390         }
<a name="l02391"></a>02391         
<a name="l02392"></a>02392         $columnParent = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">createColumnParent</a>($superColumn);
<a name="l02393"></a>02393 
<a name="l02394"></a>02394         $slicePredicate = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">createSlicePredicate</a>(
<a name="l02395"></a>02395             $columns,
<a name="l02396"></a>02396             $startColumn,
<a name="l02397"></a>02397             $endColumn,
<a name="l02398"></a>02398             <span class="keyword">false</span>,
<a name="l02399"></a>02399             2147483647
<a name="l02400"></a>02400         );
<a name="l02401"></a>02401 
<a name="l02402"></a>02402         <span class="keywordflow">return</span> $this-&gt;cassandra-&gt;call(
<a name="l02403"></a>02403             <span class="stringliteral">&#39;multiget_count&#39;</span>,
<a name="l02404"></a>02404             $keys,
<a name="l02405"></a>02405             $columnParent,
<a name="l02406"></a>02406             $slicePredicate,
<a name="l02407"></a>02407             $consistency
<a name="l02408"></a>02408         );
<a name="l02409"></a>02409     }
<a name="l02410"></a>02410     
<a name="l02432"></a><a class="code" href="classCassandraColumnFamily.html#ac454829a16d93dbfeab3227a7c25c21b">02432</a>     <span class="keyword">public</span> function <span class="keyword">set</span>(
<a name="l02433"></a>02433         $key,
<a name="l02434"></a>02434         array $columns,
<a name="l02435"></a>02435         $consistency = null,
<a name="l02436"></a>02436         $timestamp = null,
<a name="l02437"></a>02437         $timeToLiveSeconds = null
<a name="l02438"></a>02438     ) {
<a name="l02439"></a>02439         <span class="keywordflow">if</span> ($timestamp === null) {
<a name="l02440"></a>02440             $timestamp = <a class="code" href="classCassandraUtil.html#ad5c94f8a7e99e7240385cf471c2b4ae8">CassandraUtil::getTimestamp</a>();
<a name="l02441"></a>02441         }
<a name="l02442"></a>02442         
<a name="l02443"></a>02443         <span class="keywordflow">if</span> ($consistency === null) {
<a name="l02444"></a>02444             $consistency = $this-&gt;defaultWriteConsistency;
<a name="l02445"></a>02445         }
<a name="l02446"></a>02446         
<a name="l02447"></a>02447         $mutationMap = array(
<a name="l02448"></a>02448             $key =&gt; array(
<a name="l02449"></a>02449                 $this-&gt;name =&gt; $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a064cc8504629412967fbd51f7b2ea142">createColumnMutations</a>(
<a name="l02450"></a>02450                     $columns,
<a name="l02451"></a>02451                     $timestamp,
<a name="l02452"></a>02452                     $timeToLiveSeconds
<a name="l02453"></a>02453                 )
<a name="l02454"></a>02454             )
<a name="l02455"></a>02455         );
<a name="l02456"></a>02456         
<a name="l02457"></a>02457         $this-&gt;cassandra-&gt;call(<span class="stringliteral">&#39;batch_mutate&#39;</span>, $mutationMap, $consistency);
<a name="l02458"></a>02458     }
<a name="l02459"></a>02459     
<a name="l02469"></a><a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">02469</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a24a18b8d29af8c47ee94b1795667e51c">createColumnParent</a>($superColumnName = null) {
<a name="l02470"></a>02470         $schema = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa5e0d45507ac78641f7df1d0fc7845fd">getSchema</a>();
<a name="l02471"></a>02471         
<a name="l02472"></a>02472         $columnParent = <span class="keyword">new</span> cassandra_ColumnParent();
<a name="l02473"></a>02473         $columnParent-&gt;column_family = $this-&gt;name;
<a name="l02474"></a>02474         
<a name="l02475"></a>02475         <span class="keywordflow">if</span> ($superColumnName !== null) {
<a name="l02476"></a>02476             <span class="keywordflow">if</span> ($this-&gt;autopack) {
<a name="l02477"></a>02477                 $columnParent-&gt;super_column = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02478"></a>02478                     $superColumnName,
<a name="l02479"></a>02479                     $schema[<span class="stringliteral">&#39;super-type&#39;</span>]
<a name="l02480"></a>02480                 );
<a name="l02481"></a>02481             } <span class="keywordflow">else</span> {
<a name="l02482"></a>02482                 $columnParent-&gt;super_column = $superColumnName;
<a name="l02483"></a>02483             }
<a name="l02484"></a>02484         }
<a name="l02485"></a>02485         
<a name="l02486"></a>02486         <span class="keywordflow">return</span> $columnParent;
<a name="l02487"></a>02487     }
<a name="l02488"></a>02488     
<a name="l02502"></a><a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">02502</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a2ffef14e39bbe06dc8dc04638941268d">createSlicePredicate</a>(
<a name="l02503"></a>02503         $columns,
<a name="l02504"></a>02504         $startColumn,
<a name="l02505"></a>02505         $endColumn,
<a name="l02506"></a>02506         $columnsReversed,
<a name="l02507"></a>02507         $columnCount
<a name="l02508"></a>02508     ) {
<a name="l02509"></a>02509         $predicate = <span class="keyword">new</span> cassandra_SlicePredicate();
<a name="l02510"></a>02510         $schema = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa5e0d45507ac78641f7df1d0fc7845fd">getSchema</a>();
<a name="l02511"></a>02511         
<a name="l02512"></a>02512         <span class="keywordflow">if</span> (is_array($columns)) {
<a name="l02513"></a>02513             <span class="keywordflow">if</span> ($this-&gt;autopack) {
<a name="l02514"></a>02514                 $packedColumns = array();
<a name="l02515"></a>02515 
<a name="l02516"></a>02516                 <span class="keywordflow">foreach</span> ($columns as $columnName) {
<a name="l02517"></a>02517                     $columnType = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>();
<a name="l02518"></a>02518                     
<a name="l02519"></a>02519                     $packedColumns[] = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02520"></a>02520                         $columnName,
<a name="l02521"></a>02521                         $columnType
<a name="l02522"></a>02522                     );
<a name="l02523"></a>02523                 }
<a name="l02524"></a>02524                 
<a name="l02525"></a>02525                 $predicate-&gt;column_names = $packedColumns;
<a name="l02526"></a>02526             } <span class="keywordflow">else</span> {
<a name="l02527"></a>02527                 $predicate-&gt;column_names = $columns;
<a name="l02528"></a>02528             }
<a name="l02529"></a>02529         } <span class="keywordflow">else</span> {
<a name="l02530"></a>02530             <span class="keywordflow">if</span> ($this-&gt;autopack) {
<a name="l02531"></a>02531                 <span class="keywordflow">if</span> ($startColumn === null) {
<a name="l02532"></a>02532                     $startColumn = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02533"></a>02533                 }
<a name="l02534"></a>02534                 
<a name="l02535"></a>02535                 <span class="keywordflow">if</span> ($endColumn === null) {
<a name="l02536"></a>02536                     $endColumn = <span class="stringliteral">&#39;&#39;</span>;
<a name="l02537"></a>02537                 }
<a name="l02538"></a>02538                 
<a name="l02539"></a>02539                 <span class="keywordflow">if</span> (!empty($startColumn)) {
<a name="l02540"></a>02540                     $columnType = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>();
<a name="l02541"></a>02541                     
<a name="l02542"></a>02542                     $startColumn = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02543"></a>02543                         $startColumn,
<a name="l02544"></a>02544                         $columnType
<a name="l02545"></a>02545                     );
<a name="l02546"></a>02546                 }
<a name="l02547"></a>02547                 
<a name="l02548"></a>02548                 <span class="keywordflow">if</span> (!empty($endColumn)) {
<a name="l02549"></a>02549                     $columnType = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>();
<a name="l02550"></a>02550                     
<a name="l02551"></a>02551                     $endColumn = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02552"></a>02552                         $endColumn,
<a name="l02553"></a>02553                         $columnType
<a name="l02554"></a>02554                     );
<a name="l02555"></a>02555                 }
<a name="l02556"></a>02556             }
<a name="l02557"></a>02557             
<a name="l02558"></a>02558             $sliceRange = <span class="keyword">new</span> cassandra_SliceRange();
<a name="l02559"></a>02559             $sliceRange-&gt;count = $columnCount;
<a name="l02560"></a>02560             $sliceRange-&gt;reversed = $columnsReversed;
<a name="l02561"></a>02561             $sliceRange-&gt;start = $startColumn;
<a name="l02562"></a>02562             $sliceRange-&gt;finish = $endColumn;
<a name="l02563"></a>02563             
<a name="l02564"></a>02564             $predicate-&gt;slice_range = $sliceRange;
<a name="l02565"></a>02565         }
<a name="l02566"></a>02566         
<a name="l02567"></a>02567         <span class="keywordflow">return</span> $predicate;
<a name="l02568"></a>02568     }
<a name="l02569"></a>02569     
<a name="l02581"></a><a class="code" href="classCassandraColumnFamily.html#a7996d424367e08607847f14f93006cb6">02581</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a7996d424367e08607847f14f93006cb6">createIndexClause</a>(
<a name="l02582"></a>02582         array $where,
<a name="l02583"></a>02583         $startKey = null,
<a name="l02584"></a>02584         $maxRowCount = 100
<a name="l02585"></a>02585     ) {
<a name="l02586"></a>02586         $indexClause = <span class="keyword">new</span> cassandra_IndexClause();
<a name="l02587"></a>02587         $expressions = array();
<a name="l02588"></a>02588         
<a name="l02589"></a>02589         <span class="keywordflow">foreach</span> ($where as $columnName =&gt; $value) {
<a name="l02590"></a>02590             $indexExpression = <span class="keyword">new</span> cassandra_IndexExpression();
<a name="l02591"></a>02591             
<a name="l02592"></a>02592             <span class="keywordflow">if</span> (is_array($value)) {
<a name="l02593"></a>02593                 $supportedOperators = array(
<a name="l02594"></a>02594                     <a class="code" href="classCassandra.html#a33b81650dd46405f23e6d469eeb1bd5b">Cassandra::OP_EQ</a>,
<a name="l02595"></a>02595                     <a class="code" href="classCassandra.html#acf59b31536a8a886422ef7335020f99d">Cassandra::OP_LT</a>,
<a name="l02596"></a>02596                     <a class="code" href="classCassandra.html#a660ca00d7f33558017e15ccc1f8f5d29">Cassandra::OP_GT</a>,
<a name="l02597"></a>02597                     <a class="code" href="classCassandra.html#ab633158313b4f7f785910884d950f945">Cassandra::OP_LTE</a>,
<a name="l02598"></a>02598                     <a class="code" href="classCassandra.html#a60a245248555c96cadec6977014c27df">Cassandra::OP_GTE</a>
<a name="l02599"></a>02599                 );
<a name="l02600"></a>02600                 
<a name="l02601"></a>02601                 <span class="keywordflow">if</span> (
<a name="l02602"></a>02602                     count($value) != 3
<a name="l02603"></a>02603                     || !in_array($value[1], $supportedOperators)
<a name="l02604"></a>02604                 ) {
<a name="l02605"></a>02605                     <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a>(
<a name="l02606"></a>02606                         <span class="stringliteral">&#39;Invalid where clause: &#39;</span>.serialize($value)
<a name="l02607"></a>02607                     );
<a name="l02608"></a>02608                 }
<a name="l02609"></a>02609                 
<a name="l02610"></a>02610                 $indexExpression-&gt;column_name = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02611"></a>02611                     $value[0],
<a name="l02612"></a>02612                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>()
<a name="l02613"></a>02613                 );
<a name="l02614"></a>02614                 
<a name="l02615"></a>02615                 $indexExpression-&gt;op = $value[1];
<a name="l02616"></a>02616                 
<a name="l02617"></a>02617                 $indexExpression-&gt;value = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02618"></a>02618                     $value[2],
<a name="l02619"></a>02619                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">getColumnValueType</a>($value[0])
<a name="l02620"></a>02620                 );
<a name="l02621"></a>02621             } <span class="keywordflow">else</span> {
<a name="l02622"></a>02622                 $indexExpression-&gt;column_name = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02623"></a>02623                     $columnName,
<a name="l02624"></a>02624                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>()
<a name="l02625"></a>02625                 );
<a name="l02626"></a>02626                 
<a name="l02627"></a>02627                 $indexExpression-&gt;op = <a class="code" href="classCassandra.html#a33b81650dd46405f23e6d469eeb1bd5b">Cassandra::OP_EQ</a>;
<a name="l02628"></a>02628                 
<a name="l02629"></a>02629                 $indexExpression-&gt;value = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02630"></a>02630                     $value,
<a name="l02631"></a>02631                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">getColumnValueType</a>($columnName)
<a name="l02632"></a>02632                 );
<a name="l02633"></a>02633             }
<a name="l02634"></a>02634             
<a name="l02635"></a>02635             $expressions[] = $indexExpression;
<a name="l02636"></a>02636         }
<a name="l02637"></a>02637         
<a name="l02638"></a>02638         $indexClause-&gt;expressions = $expressions;
<a name="l02639"></a>02639         $indexClause-&gt;start_key = $startKey !== null ? $startKey : <span class="stringliteral">&#39;&#39;</span>;
<a name="l02640"></a>02640         $indexClause-&gt;count = $maxRowCount;
<a name="l02641"></a>02641         
<a name="l02642"></a>02642         <span class="keywordflow">return</span> $indexClause;
<a name="l02643"></a>02643     }
<a name="l02644"></a>02644     
<a name="l02656"></a><a class="code" href="classCassandraColumnFamily.html#a064cc8504629412967fbd51f7b2ea142">02656</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a064cc8504629412967fbd51f7b2ea142">createColumnMutations</a>(
<a name="l02657"></a>02657         array $columns,
<a name="l02658"></a>02658         $timestamp = null,
<a name="l02659"></a>02659         $timeToLiveSeconds = null
<a name="l02660"></a>02660     ) {
<a name="l02661"></a>02661         <span class="keywordflow">if</span> ($timestamp === null) {
<a name="l02662"></a>02662             $timestamp = <a class="code" href="classCassandraUtil.html#ad5c94f8a7e99e7240385cf471c2b4ae8">CassandraUtil::getTimestamp</a>();
<a name="l02663"></a>02663         }
<a name="l02664"></a>02664         
<a name="l02665"></a>02665         $columnsOrSuperColumns = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#adaf083d46ade0120f269254ef8c011cf">createColumnsOrSuperColumns</a>(
<a name="l02666"></a>02666             $columns,
<a name="l02667"></a>02667             $timestamp,
<a name="l02668"></a>02668             $timeToLiveSeconds
<a name="l02669"></a>02669         );
<a name="l02670"></a>02670         
<a name="l02671"></a>02671         $mutations = array();
<a name="l02672"></a>02672         
<a name="l02673"></a>02673         <span class="keywordflow">foreach</span> ($columnsOrSuperColumns as $columnOrSuperColumn) {
<a name="l02674"></a>02674             $mutation = <span class="keyword">new</span> cassandra_Mutation();
<a name="l02675"></a>02675             $mutation-&gt;column_or_supercolumn = $columnOrSuperColumn;
<a name="l02676"></a>02676             
<a name="l02677"></a>02677             $mutations[] = $mutation;
<a name="l02678"></a>02678         }
<a name="l02679"></a>02679         
<a name="l02680"></a>02680         <span class="keywordflow">return</span> $mutations;
<a name="l02681"></a>02681     }
<a name="l02682"></a>02682     
<a name="l02696"></a><a class="code" href="classCassandraColumnFamily.html#adaf083d46ade0120f269254ef8c011cf">02696</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#adaf083d46ade0120f269254ef8c011cf">createColumnsOrSuperColumns</a>(
<a name="l02697"></a>02697         array $columns,
<a name="l02698"></a>02698         $timestamp = null,
<a name="l02699"></a>02699         $timeToLiveSeconds = null
<a name="l02700"></a>02700     ) {
<a name="l02701"></a>02701         <span class="keywordflow">if</span> ($timestamp === null) {
<a name="l02702"></a>02702             $timestamp = <a class="code" href="classCassandraUtil.html#ad5c94f8a7e99e7240385cf471c2b4ae8">CassandraUtil::getTimestamp</a>();
<a name="l02703"></a>02703         }
<a name="l02704"></a>02704         
<a name="l02705"></a>02705         $results = array();
<a name="l02706"></a>02706         
<a name="l02707"></a>02707         <span class="keywordflow">foreach</span> ($columns as $columnName =&gt; $columnValue) {
<a name="l02708"></a>02708             $column = <span class="keyword">new</span> cassandra_ColumnOrSuperColumn();
<a name="l02709"></a>02709             
<a name="l02710"></a>02710             <span class="keywordflow">if</span> (is_array($columnValue)) {
<a name="l02711"></a>02711                 $column-&gt;super_column = <span class="keyword">new</span> cassandra_SuperColumn();
<a name="l02712"></a>02712                 $column-&gt;super_column-&gt;name = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02713"></a>02713                     $columnName,
<a name="l02714"></a>02714                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>()
<a name="l02715"></a>02715                 );
<a name="l02716"></a>02716                 $column-&gt;super_column-&gt;columns = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a6cb541d3f68ed99bc8c53725f4d95d2c">createColumns</a>(
<a name="l02717"></a>02717                     $columnValue,
<a name="l02718"></a>02718                     $timestamp,
<a name="l02719"></a>02719                     $timeToLiveSeconds
<a name="l02720"></a>02720                 );
<a name="l02721"></a>02721                 $column-&gt;super_column-&gt;timestamp = $timestamp;
<a name="l02722"></a>02722             } <span class="keywordflow">else</span> {
<a name="l02723"></a>02723                 $column-&gt;column = <span class="keyword">new</span> cassandra_Column();
<a name="l02724"></a>02724                 $column-&gt;column-&gt;name = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02725"></a>02725                     $columnName,
<a name="l02726"></a>02726                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>()
<a name="l02727"></a>02727                 );
<a name="l02728"></a>02728                 $column-&gt;column-&gt;value = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02729"></a>02729                     $columnValue,
<a name="l02730"></a>02730                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">getColumnValueType</a>($columnName)
<a name="l02731"></a>02731                 );
<a name="l02732"></a>02732                 $column-&gt;column-&gt;timestamp = $timestamp;
<a name="l02733"></a>02733                 $column-&gt;column-&gt;ttl = $timeToLiveSeconds;
<a name="l02734"></a>02734             }
<a name="l02735"></a>02735             
<a name="l02736"></a>02736             $results[] = $column;
<a name="l02737"></a>02737         }
<a name="l02738"></a>02738         
<a name="l02739"></a>02739         <span class="keywordflow">return</span> $results;
<a name="l02740"></a>02740     }
<a name="l02741"></a>02741     
<a name="l02754"></a><a class="code" href="classCassandraColumnFamily.html#a6cb541d3f68ed99bc8c53725f4d95d2c">02754</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a6cb541d3f68ed99bc8c53725f4d95d2c">createColumns</a>(
<a name="l02755"></a>02755         array $columns,
<a name="l02756"></a>02756         $timestamp = null,
<a name="l02757"></a>02757         $timeToLiveSeconds = null
<a name="l02758"></a>02758     ) {
<a name="l02759"></a>02759         <span class="keywordflow">if</span> ($timestamp === null) {
<a name="l02760"></a>02760             $timestamp = <a class="code" href="classCassandraUtil.html#ad5c94f8a7e99e7240385cf471c2b4ae8">CassandraUtil::getTimestamp</a>();
<a name="l02761"></a>02761         }
<a name="l02762"></a>02762         
<a name="l02763"></a>02763         $results = array();
<a name="l02764"></a>02764         
<a name="l02765"></a>02765         <span class="keywordflow">foreach</span> ($columns as $name =&gt; $value) {
<a name="l02766"></a>02766             $column = <span class="keyword">new</span> cassandra_Column();
<a name="l02767"></a>02767             $column-&gt;name = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02768"></a>02768                 $name,
<a name="l02769"></a>02769                 $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>()
<a name="l02770"></a>02770             );
<a name="l02771"></a>02771             $column-&gt;value = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">CassandraUtil::pack</a>(
<a name="l02772"></a>02772                 $value,
<a name="l02773"></a>02773                 $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">getColumnValueType</a>($name)
<a name="l02774"></a>02774             );
<a name="l02775"></a>02775             $column-&gt;timestamp = $timestamp;
<a name="l02776"></a>02776             $column-&gt;ttl = $timeToLiveSeconds;
<a name="l02777"></a>02777             
<a name="l02778"></a>02778             $results[] = $column;
<a name="l02779"></a>02779         }
<a name="l02780"></a>02780         
<a name="l02781"></a>02781         <span class="keywordflow">return</span> $results;
<a name="l02782"></a>02782     }
<a name="l02783"></a>02783     
<a name="l02793"></a><a class="code" href="classCassandraColumnFamily.html#ae6c7410e7f68a51900a76f807531e062">02793</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#ae6c7410e7f68a51900a76f807531e062">parseSlicesResponse</a>(array $responses) {
<a name="l02794"></a>02794         $results = array();
<a name="l02795"></a>02795 
<a name="l02796"></a>02796         <span class="keywordflow">foreach</span> ($responses as $row) {
<a name="l02797"></a>02797             $key = $row-&gt;key;
<a name="l02798"></a>02798             $results[$key] = array();
<a name="l02799"></a>02799             
<a name="l02800"></a>02800             <span class="keywordflow">foreach</span> ($row-&gt;columns as $row) {
<a name="l02801"></a>02801                 $results[$key] = array_merge(
<a name="l02802"></a>02802                     $results[$key],
<a name="l02803"></a>02803                     $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a38155d2a31e9559cf0fd85c013cd9d44">parseSliceRow</a>($row)
<a name="l02804"></a>02804                 );
<a name="l02805"></a>02805             }
<a name="l02806"></a>02806         }
<a name="l02807"></a>02807         
<a name="l02808"></a>02808         <span class="keywordflow">return</span> $results;
<a name="l02809"></a>02809     }
<a name="l02810"></a>02810 
<a name="l02820"></a><a class="code" href="classCassandraColumnFamily.html#a10f09668871103443fbbe9f6747a95f8">02820</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraColumnFamily.html#a10f09668871103443fbbe9f6747a95f8">parseSliceResponse</a>(array $response) {
<a name="l02821"></a>02821         $results = array();
<a name="l02822"></a>02822         
<a name="l02823"></a>02823         <span class="keywordflow">foreach</span> ($response as $row) {
<a name="l02824"></a>02824             $results = array_merge(
<a name="l02825"></a>02825                 $results,
<a name="l02826"></a>02826                 $this-&gt;<a class="code" href="classCassandraColumnFamily.html#a38155d2a31e9559cf0fd85c013cd9d44">parseSliceRow</a>($row)
<a name="l02827"></a>02827             );
<a name="l02828"></a>02828         }
<a name="l02829"></a>02829         
<a name="l02830"></a>02830         <span class="keywordflow">return</span> $results;
<a name="l02831"></a>02831     }
<a name="l02832"></a>02832     
<a name="l02840"></a><a class="code" href="classCassandraColumnFamily.html#a38155d2a31e9559cf0fd85c013cd9d44">02840</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandraColumnFamily.html#a38155d2a31e9559cf0fd85c013cd9d44">parseSliceRow</a>(cassandra_ColumnOrSuperColumn $row) {
<a name="l02841"></a>02841         $result = array();
<a name="l02842"></a>02842         
<a name="l02843"></a>02843         <span class="keywordflow">if</span> ($row-&gt;column !== null) {
<a name="l02844"></a>02844             $nameType = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>();
<a name="l02845"></a>02845             $valueType = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">getColumnValueType</a>($row-&gt;column-&gt;name);
<a name="l02846"></a>02846 
<a name="l02847"></a>02847             $name = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">CassandraUtil::unpack</a>($row-&gt;column-&gt;name, $nameType);
<a name="l02848"></a>02848             $value = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">CassandraUtil::unpack</a>($row-&gt;column-&gt;value, $valueType);
<a name="l02849"></a>02849 
<a name="l02850"></a>02850             $result[$name] = $value;
<a name="l02851"></a>02851         } <span class="keywordflow">else</span> <span class="keywordflow">if</span>($row-&gt;super_column !== null) {
<a name="l02852"></a>02852             $superNameType = null;
<a name="l02853"></a>02853 
<a name="l02854"></a>02854             $superName = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">CassandraUtil::unpack</a>(
<a name="l02855"></a>02855                 $row-&gt;super_column-&gt;name,
<a name="l02856"></a>02856                 $superNameType
<a name="l02857"></a>02857             );
<a name="l02858"></a>02858 
<a name="l02859"></a>02859             $values = array();
<a name="l02860"></a>02860 
<a name="l02861"></a>02861             <span class="keywordflow">foreach</span> ($row-&gt;super_column-&gt;columns as $column) {
<a name="l02862"></a>02862                 $nameType = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#ab41e2e964834570a3cf8ffc6b60eaefa">getColumnNameType</a>();
<a name="l02863"></a>02863                 $valueType = $this-&gt;<a class="code" href="classCassandraColumnFamily.html#aa62bec66626eba474c8fcf51dbe0eda5">getColumnValueType</a>($column-&gt;name);
<a name="l02864"></a>02864 
<a name="l02865"></a>02865                 $name = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">CassandraUtil::unpack</a>($column-&gt;name, $nameType);
<a name="l02866"></a>02866                 $value = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">CassandraUtil::unpack</a>($column-&gt;value, $valueType);
<a name="l02867"></a>02867 
<a name="l02868"></a>02868                 $values[$name] = $value;
<a name="l02869"></a>02869             }
<a name="l02870"></a>02870 
<a name="l02871"></a>02871             $result[$superName] = $values;
<a name="l02872"></a>02872         } <span class="keywordflow">else</span> {
<a name="l02873"></a>02873             <span class="comment">// @codeCoverageIgnoreStart</span>
<a name="l02874"></a>02874             <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&#39;Expected either normal or super column&#39;</span>);
<a name="l02875"></a>02875             <span class="comment">// @codeCoverageIgnoreEnd</span>
<a name="l02876"></a>02876         }
<a name="l02877"></a>02877 
<a name="l02878"></a>02878         <span class="keywordflow">return</span> $result;
<a name="l02879"></a>02879     }
<a name="l02880"></a>02880 }
<a name="l02881"></a>02881 
<a name="l02888"></a><a class="code" href="classCassandraUtil.html">02888</a> <span class="keyword">class </span><a class="code" href="classCassandraUtil.html">CassandraUtil</a> {
<a name="l02889"></a>02889     
<a name="l02898"></a><a class="code" href="classCassandraUtil.html#a0c6545c1306d917051a53598a0f23ee6">02898</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#a0c6545c1306d917051a53598a0f23ee6">extractType</a>($definition) {
<a name="l02899"></a>02899         <span class="keywordflow">if</span> ($definition === null or $definition == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l02900"></a>02900             <span class="keywordflow">return</span> <a class="code" href="classCassandra.html#ab75de9aa0588c7665f1c9d8cf8d4e8ff">Cassandra::TYPE_BYTES</a>;
<a name="l02901"></a>02901         }
<a name="l02902"></a>02902 
<a name="l02903"></a>02903         $index = strrpos($definition, <span class="charliteral">&#39;.&#39;</span>);
<a name="l02904"></a>02904 
<a name="l02905"></a>02905         <span class="keywordflow">if</span> ($index === <span class="keyword">false</span>) {
<a name="l02906"></a>02906             <span class="keywordflow">return</span> <a class="code" href="classCassandra.html#ab75de9aa0588c7665f1c9d8cf8d4e8ff">Cassandra::TYPE_BYTES</a>;
<a name="l02907"></a>02907         }
<a name="l02908"></a>02908 
<a name="l02909"></a>02909         <span class="keywordflow">return</span> substr($definition, $index + 1);
<a name="l02910"></a>02910     }
<a name="l02911"></a>02911     
<a name="l02919"></a><a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">02919</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">pack</a>($value, $type) {
<a name="l02920"></a>02920         <span class="keywordflow">switch</span> ($type) {
<a name="l02921"></a>02921             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#acf64f8105c4bfe0c95f868437299442f">Cassandra::TYPE_LONG</a>:
<a name="l02922"></a>02922                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#a92f49d16f99991a04a3f798ee91f7d0b">self::packLong</a>($value);
<a name="l02923"></a>02923             
<a name="l02924"></a>02924             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#a4160c654a18aead3a642fd1f3f2415e9">Cassandra::TYPE_INTEGER</a>:
<a name="l02925"></a>02925                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#aa5b20568dcda475aba51dc1ac6bdfcb1">self::packInteger</a>($value);
<a name="l02926"></a>02926             
<a name="l02927"></a>02927             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#acc917786b5bbbdd6eb4783856bd5580c">Cassandra::TYPE_ASCII</a>:
<a name="l02928"></a>02928                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#a5e6486c8b5438bf565f13789f0403053">self::packString</a>($value, strlen($value));
<a name="l02929"></a>02929             
<a name="l02930"></a>02930             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>:
<a name="l02931"></a>02931                 <span class="keywordflow">if</span> (mb_detect_encoding($value, <span class="stringliteral">&#39;UTF-8&#39;</span>) != <span class="stringliteral">&#39;UTF-8&#39;</span>) {
<a name="l02932"></a>02932                     $value = utf8_encode($value);
<a name="l02933"></a>02933                 }
<a name="l02934"></a>02934                 
<a name="l02935"></a>02935                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#a5e6486c8b5438bf565f13789f0403053">self::packString</a>($value, strlen($value));
<a name="l02936"></a>02936                 
<a name="l02937"></a>02937             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#a42861ad94788ba940228767a79f1c4c7">Cassandra::TYPE_TIME_UUID</a>:
<a name="l02938"></a>02938                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#a5e6486c8b5438bf565f13789f0403053">self::packString</a>($value, 16);
<a name="l02939"></a>02939             
<a name="l02940"></a>02940             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#a2af16bdea44f4e16ba5c5baa5380b9f0">Cassandra::TYPE_LEXICAL_UUID</a>:
<a name="l02941"></a>02941                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#a5e6486c8b5438bf565f13789f0403053">self::packString</a>($value, 16);
<a name="l02942"></a>02942                 
<a name="l02943"></a>02943             <span class="keywordflow">default</span>:
<a name="l02944"></a>02944                 <span class="keywordflow">return</span> $value;
<a name="l02945"></a>02945         }
<a name="l02946"></a>02946     }
<a name="l02947"></a>02947     
<a name="l02954"></a><a class="code" href="classCassandraUtil.html#a92f49d16f99991a04a3f798ee91f7d0b">02954</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#a92f49d16f99991a04a3f798ee91f7d0b">packLong</a>($value) {
<a name="l02955"></a>02955         <span class="comment">// If we are on a 32bit architecture we have to explicitly deal with</span>
<a name="l02956"></a>02956         <span class="comment">// 64-bit twos-complement arithmetic since PHP wants to treat all ints</span>
<a name="l02957"></a>02957         <span class="comment">// as signed and any int over 2^31 - 1 as a float</span>
<a name="l02958"></a>02958         <span class="keywordflow">if</span> (PHP_INT_SIZE == 4) {
<a name="l02959"></a>02959             $neg = $value &lt; 0;
<a name="l02960"></a>02960 
<a name="l02961"></a>02961             <span class="keywordflow">if</span> ($neg) {
<a name="l02962"></a>02962                 $value *= - 1;
<a name="l02963"></a>02963             }
<a name="l02964"></a>02964 
<a name="l02965"></a>02965             $hi = (int) ($value / 4294967296);
<a name="l02966"></a>02966             $lo = (int) $value;
<a name="l02967"></a>02967 
<a name="l02968"></a>02968             <span class="keywordflow">if</span> ($neg) {
<a name="l02969"></a>02969                 $hi = ~$hi;
<a name="l02970"></a>02970                 $lo = ~$lo;
<a name="l02971"></a>02971                 
<a name="l02972"></a>02972                 <span class="keywordflow">if</span> (($lo &amp; (<span class="keywordtype">int</span>)0xffffffff) == (<span class="keywordtype">int</span>)0xffffffff) {
<a name="l02973"></a>02973                     $lo = 0;
<a name="l02974"></a>02974                     $hi++;
<a name="l02975"></a>02975                 } <span class="keywordflow">else</span> {
<a name="l02976"></a>02976                     $lo++;
<a name="l02977"></a>02977                 }
<a name="l02978"></a>02978             }
<a name="l02979"></a>02979             
<a name="l02980"></a>02980             $data = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">pack</a>(<span class="stringliteral">&#39;N2&#39;</span>, $hi, $lo);
<a name="l02981"></a>02981         } <span class="keywordflow">else</span> {
<a name="l02982"></a>02982             $hi = $value &gt;&gt; 32;
<a name="l02983"></a>02983             $lo = $value &amp; 0xFFFFFFFF;
<a name="l02984"></a>02984             
<a name="l02985"></a>02985             $data = <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">pack</a>(<span class="stringliteral">&#39;N2&#39;</span>, $hi, $lo);
<a name="l02986"></a>02986         }
<a name="l02987"></a>02987         
<a name="l02988"></a>02988         <span class="keywordflow">return</span> $data;
<a name="l02989"></a>02989     }
<a name="l02990"></a>02990     
<a name="l02997"></a><a class="code" href="classCassandraUtil.html#aa5b20568dcda475aba51dc1ac6bdfcb1">02997</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#aa5b20568dcda475aba51dc1ac6bdfcb1">packInteger</a>($value) {
<a name="l02998"></a>02998         <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">pack</a>(<span class="charliteral">&#39;N&#39;</span>, $value);
<a name="l02999"></a>02999     }
<a name="l03000"></a>03000     
<a name="l03007"></a><a class="code" href="classCassandraUtil.html#a5e6486c8b5438bf565f13789f0403053">03007</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#a5e6486c8b5438bf565f13789f0403053">packString</a>($string, $length) {       
<a name="l03008"></a>03008         $result = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03009"></a>03009         
<a name="l03010"></a>03010         <span class="keywordflow">for</span>($i = 0; $i &lt; $length; $i++) {
<a name="l03011"></a>03011             $result .= <a class="code" href="classCassandraUtil.html#aa70ff00c6c785127c87a46c966999e66">pack</a>(<span class="charliteral">&#39;c&#39;</span>, ord(substr($string, $i, 1)));
<a name="l03012"></a>03012         }
<a name="l03013"></a>03013         
<a name="l03014"></a>03014         <span class="keywordflow">return</span> $result;
<a name="l03015"></a>03015     }
<a name="l03016"></a>03016     
<a name="l03024"></a><a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">03024</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">unpack</a>($value, $type) {
<a name="l03025"></a>03025         <span class="keywordflow">switch</span> ($type) {
<a name="l03026"></a>03026             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#acf64f8105c4bfe0c95f868437299442f">Cassandra::TYPE_LONG</a>:
<a name="l03027"></a>03027                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#a8753dea96e94a3c84d8e5aada1418dbb">self::unpackLong</a>($value);
<a name="l03028"></a>03028             
<a name="l03029"></a>03029             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#a4160c654a18aead3a642fd1f3f2415e9">Cassandra::TYPE_INTEGER</a>:
<a name="l03030"></a>03030                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#ab0dcf37a5de9d22e665ca291a3afd4a2">self::unpackInteger</a>($value);
<a name="l03031"></a>03031             
<a name="l03032"></a>03032             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#acc917786b5bbbdd6eb4783856bd5580c">Cassandra::TYPE_ASCII</a>:
<a name="l03033"></a>03033                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#ab49d399bb60d2e0094de49b77cd00dbe">self::unpackString</a>($value, strlen($value));
<a name="l03034"></a>03034             
<a name="l03035"></a>03035             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#ac03a89bd430178d9bce987eba8001b82">Cassandra::TYPE_UTF8</a>:
<a name="l03036"></a>03036                 <span class="keywordflow">return</span> <a class="code" href="classCassandraUtil.html#ab49d399bb60d2e0094de49b77cd00dbe">self::unpackString</a>($value, strlen($value));
<a name="l03037"></a>03037                 
<a name="l03038"></a>03038             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#a42861ad94788ba940228767a79f1c4c7">Cassandra::TYPE_TIME_UUID</a>:
<a name="l03039"></a>03039                 <span class="keywordflow">return</span> $value;
<a name="l03040"></a>03040             
<a name="l03041"></a>03041             <span class="keywordflow">case</span> <a class="code" href="classCassandra.html#a2af16bdea44f4e16ba5c5baa5380b9f0">Cassandra::TYPE_LEXICAL_UUID</a>:
<a name="l03042"></a>03042                 <span class="keywordflow">return</span> $value;
<a name="l03043"></a>03043                 
<a name="l03044"></a>03044             <span class="keywordflow">default</span>:
<a name="l03045"></a>03045                 <span class="keywordflow">return</span> $value;
<a name="l03046"></a>03046         }
<a name="l03047"></a>03047     }
<a name="l03048"></a>03048     
<a name="l03055"></a><a class="code" href="classCassandraUtil.html#a8753dea96e94a3c84d8e5aada1418dbb">03055</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#a8753dea96e94a3c84d8e5aada1418dbb">unpackLong</a>($data) {
<a name="l03056"></a>03056         $arr = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">unpack</a>(<span class="stringliteral">&#39;N2&#39;</span>, $data);
<a name="l03057"></a>03057 
<a name="l03058"></a>03058         <span class="comment">// If we are on a 32bit architecture we have to explicitly deal with</span>
<a name="l03059"></a>03059         <span class="comment">// 64-bit twos-complement arithmetic since PHP wants to treat all ints</span>
<a name="l03060"></a>03060         <span class="comment">// as signed and any int over 2^31 - 1 as a float</span>
<a name="l03061"></a>03061         <span class="keywordflow">if</span> (PHP_INT_SIZE == 4) {
<a name="l03062"></a>03062 
<a name="l03063"></a>03063             $hi = $arr[1];
<a name="l03064"></a>03064             $lo = $arr[2];
<a name="l03065"></a>03065             $isNeg = $hi &lt; 0;
<a name="l03066"></a>03066 
<a name="l03067"></a>03067             <span class="comment">// Check for a negative</span>
<a name="l03068"></a>03068             <span class="keywordflow">if</span> ($isNeg) {
<a name="l03069"></a>03069                 $hi = ~$hi &amp; (int)0xffffffff;
<a name="l03070"></a>03070                 $lo = ~$lo &amp; (int)0xffffffff;
<a name="l03071"></a>03071 
<a name="l03072"></a>03072                 <span class="keywordflow">if</span> ($lo == (<span class="keywordtype">int</span>)0xffffffff) {
<a name="l03073"></a>03073                     $hi++;
<a name="l03074"></a>03074                     $lo = 0;
<a name="l03075"></a>03075                 } <span class="keywordflow">else</span> {
<a name="l03076"></a>03076                     $lo++;
<a name="l03077"></a>03077                 }
<a name="l03078"></a>03078             }
<a name="l03079"></a>03079 
<a name="l03080"></a>03080             <span class="comment">// Force 32bit words in excess of 2G to pe positive - we deal wigh</span>
<a name="l03081"></a>03081             <span class="comment">// sign explicitly below</span>
<a name="l03082"></a>03082 
<a name="l03083"></a>03083             <span class="keywordflow">if</span> ($hi &amp; (<span class="keywordtype">int</span>)0x80000000) {
<a name="l03084"></a>03084                 $hi &amp;= (int)0x7fffffff;
<a name="l03085"></a>03085                 $hi += 0x80000000;
<a name="l03086"></a>03086             }
<a name="l03087"></a>03087 
<a name="l03088"></a>03088             <span class="keywordflow">if</span> ($lo &amp; (<span class="keywordtype">int</span>)0x80000000) {
<a name="l03089"></a>03089                 $lo &amp;= (int)0x7fffffff;
<a name="l03090"></a>03090                 $lo += 0x80000000;
<a name="l03091"></a>03091             }
<a name="l03092"></a>03092 
<a name="l03093"></a>03093             $value = $hi * 4294967296 + $lo;
<a name="l03094"></a>03094 
<a name="l03095"></a>03095             <span class="keywordflow">if</span> ($isNeg) {
<a name="l03096"></a>03096                 $value = 0 - $value;
<a name="l03097"></a>03097             }
<a name="l03098"></a>03098         } <span class="keywordflow">else</span> {
<a name="l03099"></a>03099             <span class="comment">// Upcast negatives in LSB bit</span>
<a name="l03100"></a>03100             <span class="keywordflow">if</span> ($arr[2] &amp; 0x80000000)
<a name="l03101"></a>03101                 $arr[2] = $arr[2] &amp; 0xffffffff;
<a name="l03102"></a>03102 
<a name="l03103"></a>03103             <span class="comment">// Check for a negative</span>
<a name="l03104"></a>03104             <span class="keywordflow">if</span> ($arr[1] &amp; 0x80000000) {
<a name="l03105"></a>03105                 $arr[1] = $arr[1] &amp; 0xffffffff;
<a name="l03106"></a>03106                 $arr[1] = $arr[1] ^ 0xffffffff;
<a name="l03107"></a>03107                 $arr[2] = $arr[2] ^ 0xffffffff;
<a name="l03108"></a>03108                 
<a name="l03109"></a>03109                 $value = 0 - $arr[1] * 4294967296 - $arr[2] - 1;
<a name="l03110"></a>03110             } <span class="keywordflow">else</span> {
<a name="l03111"></a>03111                 $value = $arr[1] * 4294967296 + $arr[2];
<a name="l03112"></a>03112             }
<a name="l03113"></a>03113         }
<a name="l03114"></a>03114         
<a name="l03115"></a>03115         <span class="keywordflow">return</span> $value;
<a name="l03116"></a>03116     }
<a name="l03117"></a>03117     
<a name="l03124"></a><a class="code" href="classCassandraUtil.html#ab0dcf37a5de9d22e665ca291a3afd4a2">03124</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#ab0dcf37a5de9d22e665ca291a3afd4a2">unpackInteger</a>($value) {
<a name="l03125"></a>03125         $unpacked = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">unpack</a>(<span class="charliteral">&#39;N&#39;</span>, $value);
<a name="l03126"></a>03126         
<a name="l03127"></a>03127         <span class="keywordflow">return</span> array_pop($unpacked);
<a name="l03128"></a>03128     }
<a name="l03129"></a>03129     
<a name="l03136"></a><a class="code" href="classCassandraUtil.html#ab49d399bb60d2e0094de49b77cd00dbe">03136</a>     <span class="keyword">public</span> <span class="keyword">static</span> function <a class="code" href="classCassandraUtil.html#ab49d399bb60d2e0094de49b77cd00dbe">unpackString</a>($value, $length) {
<a name="l03137"></a>03137         $unpacked = <a class="code" href="classCassandraUtil.html#a0e4efa10d6999de6fbbc2efa3f24a089">unpack</a>(<span class="charliteral">&#39;c&#39;</span>.$length.<span class="stringliteral">&#39;chars&#39;</span>, $value);
<a name="l03138"></a>03138         $out = <span class="stringliteral">&#39;&#39;</span>;
<a name="l03139"></a>03139         
<a name="l03140"></a>03140         <span class="keywordflow">foreach</span>($unpacked as $element) {
<a name="l03141"></a>03141             <span class="keywordflow">if</span>($element &gt; 0) {
<a name="l03142"></a>03142                 $out .= chr($element);
<a name="l03143"></a>03143             }
<a name="l03144"></a>03144         }
<a name="l03145"></a>03145         
<a name="l03146"></a>03146         <span class="keywordflow">return</span> $out;
<a name="l03147"></a>03147     }
<a name="l03148"></a>03148     
<a name="l03156"></a><a class="code" href="classCassandraUtil.html#ad5c94f8a7e99e7240385cf471c2b4ae8">03156</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraUtil.html#ad5c94f8a7e99e7240385cf471c2b4ae8">getTimestamp</a>() {
<a name="l03157"></a>03157         $microtime = microtime();
<a name="l03158"></a>03158         
<a name="l03159"></a>03159         settype($microtime, <span class="stringliteral">&#39;string&#39;</span>);
<a name="l03160"></a>03160         
<a name="l03161"></a>03161         $timeTokens = explode(<span class="stringliteral">&quot; &quot;</span>, $microtime);
<a name="l03162"></a>03162         $subSeconds = preg_replace(<span class="stringliteral">&#39;/0./&#39;</span>, <span class="stringliteral">&#39;&#39;</span>, $timeTokens[0], 1);
<a name="l03163"></a>03163         
<a name="l03164"></a>03164         <span class="keywordflow">return</span> ($timeTokens[1].$subSeconds) / 100;
<a name="l03165"></a>03165     }
<a name="l03166"></a>03166 }
<a name="l03167"></a>03167 
<a name="l03176"></a><a class="code" href="classCassandraDataIterator.html">03176</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classCassandraDataIterator.html">CassandraDataIterator</a> <span class="keyword">implements</span> Iterator {
<a name="l03177"></a>03177     
<a name="l03183"></a>03183     <span class="keyword">protected</span> $columnFamily;
<a name="l03184"></a>03184     
<a name="l03190"></a>03190     <span class="keyword">protected</span> $columnParent;
<a name="l03191"></a>03191     
<a name="l03197"></a>03197     <span class="keyword">protected</span> $slicePredicate;
<a name="l03198"></a>03198     
<a name="l03204"></a>03204     <span class="keyword">protected</span> $consistency;
<a name="l03205"></a>03205     
<a name="l03213"></a>03213     <span class="keyword">protected</span> $rowCountLimit;
<a name="l03214"></a>03214     
<a name="l03220"></a>03220     <span class="keyword">protected</span> $bufferSize;
<a name="l03221"></a>03221     
<a name="l03227"></a>03227     <span class="keyword">protected</span> $buffer;
<a name="l03228"></a>03228     
<a name="l03234"></a>03234     <span class="keyword">protected</span> $originalStartKey;
<a name="l03235"></a>03235     
<a name="l03241"></a>03241     <span class="keyword">protected</span> $nextStartKey;
<a name="l03242"></a>03242     
<a name="l03248"></a>03248     <span class="keyword">protected</span> $isValid;
<a name="l03249"></a>03249     
<a name="l03255"></a>03255     <span class="keyword">protected</span> $rowsSeen;
<a name="l03256"></a>03256     
<a name="l03262"></a>03262     <span class="keyword">protected</span> $expectedPageSize;
<a name="l03263"></a>03263     
<a name="l03269"></a>03269     <span class="keyword">protected</span> $currentPageSize;
<a name="l03270"></a>03270     
<a name="l03282"></a><a class="code" href="classCassandraDataIterator.html#adfcc357f08ade6908e0304a8c93226b4">03282</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraDataIterator.html#adfcc357f08ade6908e0304a8c93226b4">__construct</a>(
<a name="l03283"></a>03283         <a class="code" href="classCassandraColumnFamily.html">CassandraColumnFamily</a> $columnFamily,
<a name="l03284"></a>03284         cassandra_ColumnParent $columnParent,
<a name="l03285"></a>03285         cassandra_SlicePredicate $slicePredicate,
<a name="l03286"></a>03286         $startKey,
<a name="l03287"></a>03287         $consistency,
<a name="l03288"></a>03288         $rowCountLimit,
<a name="l03289"></a>03289         $bufferSize
<a name="l03290"></a>03290     ) {
<a name="l03291"></a>03291         $this-&gt;columnFamily = $columnFamily;
<a name="l03292"></a>03292         $this-&gt;columnParent = $columnParent;
<a name="l03293"></a>03293         $this-&gt;slicePredicate = $slicePredicate;
<a name="l03294"></a>03294         $this-&gt;consistency = $consistency;
<a name="l03295"></a>03295         $this-&gt;rowCountLimit = $rowCountLimit;
<a name="l03296"></a>03296         $this-&gt;bufferSize = $bufferSize;
<a name="l03297"></a>03297         $this-&gt;originalStartKey = $startKey;
<a name="l03298"></a>03298         $this-&gt;nextStartKey = $startKey;
<a name="l03299"></a>03299         $this-&gt;buffer = null;
<a name="l03300"></a>03300         
<a name="l03301"></a>03301         <span class="keywordflow">if</span> ($rowCountLimit !== null) {
<a name="l03302"></a>03302             $this-&gt;bufferSize = min($rowCountLimit, $bufferSize);
<a name="l03303"></a>03303         }
<a name="l03304"></a>03304     }
<a name="l03305"></a>03305     
<a name="l03311"></a><a class="code" href="classCassandraDataIterator.html#a4543482c99d8a586477214766783978b">03311</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraDataIterator.html#a4543482c99d8a586477214766783978b">current</a>() {
<a name="l03312"></a>03312         <span class="keywordflow">return</span> <a class="code" href="classCassandraDataIterator.html#a4543482c99d8a586477214766783978b">current</a>($this-&gt;buffer);
<a name="l03313"></a>03313     }
<a name="l03314"></a>03314     
<a name="l03324"></a><a class="code" href="classCassandraDataIterator.html#a4cbe7dbf861e1deffaf14ae5cf2e4696">03324</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraDataIterator.html#a4cbe7dbf861e1deffaf14ae5cf2e4696">key</a>() {
<a name="l03325"></a>03325         <span class="keywordflow">return</span> <a class="code" href="classCassandraDataIterator.html#a4cbe7dbf861e1deffaf14ae5cf2e4696">key</a>($this-&gt;buffer);
<a name="l03326"></a>03326     }
<a name="l03327"></a>03327     
<a name="l03334"></a><a class="code" href="classCassandraDataIterator.html#a33a1d60da9dd9e9d610f2720558914d3">03334</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraDataIterator.html#a33a1d60da9dd9e9d610f2720558914d3">next</a>() {
<a name="l03335"></a>03335         $value = null;
<a name="l03336"></a>03336         $beyondLastRow = <span class="keyword">false</span>;
<a name="l03337"></a>03337         
<a name="l03338"></a>03338         <span class="keywordflow">if</span> (!empty($this-&gt;buffer)) {
<a name="l03339"></a>03339             $this-&gt;nextStartKey = <a class="code" href="classCassandraDataIterator.html#a4cbe7dbf861e1deffaf14ae5cf2e4696">key</a>($this-&gt;buffer);
<a name="l03340"></a>03340             
<a name="l03341"></a>03341             $value = <a class="code" href="classCassandraDataIterator.html#a33a1d60da9dd9e9d610f2720558914d3">next</a>($this-&gt;buffer);
<a name="l03342"></a>03342 
<a name="l03343"></a>03343             <span class="keywordflow">if</span> (count(<a class="code" href="classCassandraDataIterator.html#a4543482c99d8a586477214766783978b">current</a>($this-&gt;buffer)) == 0) {
<a name="l03344"></a>03344                 $this-&gt;<a class="code" href="classCassandraDataIterator.html#a33a1d60da9dd9e9d610f2720558914d3">next</a>();
<a name="l03345"></a>03345             } <span class="keywordflow">else</span> {
<a name="l03346"></a>03346                 $key = <a class="code" href="classCassandraDataIterator.html#a4cbe7dbf861e1deffaf14ae5cf2e4696">key</a>($this-&gt;buffer);
<a name="l03347"></a>03347                 
<a name="l03348"></a>03348                 <span class="keywordflow">if</span> (isset($key)) {
<a name="l03349"></a>03349                     $this-&gt;rowsSeen++;
<a name="l03350"></a>03350                     
<a name="l03351"></a>03351                     <span class="keywordflow">if</span> (
<a name="l03352"></a>03352                         $this-&gt;rowCountLimit !== null
<a name="l03353"></a>03353                         &amp;&amp; $this-&gt;rowsSeen &gt; $this-&gt;rowCountLimit
<a name="l03354"></a>03354                     ) {
<a name="l03355"></a>03355                         $this-&gt;isValid = <span class="keyword">false</span>;
<a name="l03356"></a>03356                         
<a name="l03357"></a>03357                         <span class="keywordflow">return</span> null;
<a name="l03358"></a>03358                     }
<a name="l03359"></a>03359                 } <span class="keywordflow">else</span> {
<a name="l03360"></a>03360                     $beyondLastRow = <span class="keyword">true</span>;
<a name="l03361"></a>03361                 }
<a name="l03362"></a>03362             }
<a name="l03363"></a>03363         } <span class="keywordflow">else</span> {
<a name="l03364"></a>03364             $beyondLastRow = <span class="keyword">true</span>;
<a name="l03365"></a>03365         }
<a name="l03366"></a>03366 
<a name="l03367"></a>03367         <span class="keywordflow">if</span> ($beyondLastRow) {
<a name="l03368"></a>03368             <span class="keywordflow">if</span> ($this-&gt;currentPageSize &lt; $this-&gt;expectedPageSize) {
<a name="l03369"></a>03369                 $this-&gt;isValid = <span class="keyword">false</span>;
<a name="l03370"></a>03370             } <span class="keywordflow">else</span> {
<a name="l03371"></a>03371                 $this-&gt;<a class="code" href="classCassandraDataIterator.html#a20435cd4a3a06df86d62f9975933c808">updateBuffer</a>();
<a name="l03372"></a>03372                 
<a name="l03373"></a>03373                 <span class="keywordflow">if</span> (count($this-&gt;buffer) == 1) {
<a name="l03374"></a>03374                     $this-&gt;isValid = <span class="keyword">false</span>;
<a name="l03375"></a>03375                 } <span class="keywordflow">else</span> {
<a name="l03376"></a>03376                     $this-&gt;<a class="code" href="classCassandraDataIterator.html#a33a1d60da9dd9e9d610f2720558914d3">next</a>();
<a name="l03377"></a>03377                 }
<a name="l03378"></a>03378             }
<a name="l03379"></a>03379         }
<a name="l03380"></a>03380         
<a name="l03381"></a>03381         <span class="keywordflow">return</span> $value;
<a name="l03382"></a>03382     }
<a name="l03383"></a>03383     
<a name="l03389"></a><a class="code" href="classCassandraDataIterator.html#a768a5fdcefd168820cf2ce498d4b2215">03389</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraDataIterator.html#a768a5fdcefd168820cf2ce498d4b2215">rewind</a>() {
<a name="l03390"></a>03390         $this-&gt;rowsSeen = 0;
<a name="l03391"></a>03391         $this-&gt;isValid = <span class="keyword">true</span>;
<a name="l03392"></a>03392         $this-&gt;nextStartKey = $this-&gt;originalStartKey;
<a name="l03393"></a>03393         
<a name="l03394"></a>03394         $this-&gt;<a class="code" href="classCassandraDataIterator.html#a20435cd4a3a06df86d62f9975933c808">updateBuffer</a>();
<a name="l03395"></a>03395         
<a name="l03396"></a>03396         <span class="keywordflow">if</span> (count($this-&gt;buffer) == 0) {
<a name="l03397"></a>03397             $this-&gt;isValid = <span class="keyword">false</span>;
<a name="l03398"></a>03398             
<a name="l03399"></a>03399             <span class="keywordflow">return</span>;
<a name="l03400"></a>03400         }
<a name="l03401"></a>03401         
<a name="l03402"></a>03402         <span class="keywordflow">if</span> (count(<a class="code" href="classCassandraDataIterator.html#a4543482c99d8a586477214766783978b">current</a>($this-&gt;buffer)) == 0) {
<a name="l03403"></a>03403             $this-&gt;<a class="code" href="classCassandraDataIterator.html#a33a1d60da9dd9e9d610f2720558914d3">next</a>();
<a name="l03404"></a>03404         } <span class="keywordflow">else</span> {
<a name="l03405"></a>03405             $this-&gt;rowsSeen++;
<a name="l03406"></a>03406         }
<a name="l03407"></a>03407     }
<a name="l03408"></a>03408     
<a name="l03414"></a><a class="code" href="classCassandraDataIterator.html#a5378a5276e6095d7e199ddb493d24ad8">03414</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraDataIterator.html#a5378a5276e6095d7e199ddb493d24ad8">valid</a>() {
<a name="l03415"></a>03415         <span class="keywordflow">return</span> $this-&gt;isValid;
<a name="l03416"></a>03416     }
<a name="l03417"></a>03417     
<a name="l03427"></a><a class="code" href="classCassandraDataIterator.html#abc2745605d011776a747505aafff43b3">03427</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraDataIterator.html#abc2745605d011776a747505aafff43b3">getAll</a>() {
<a name="l03428"></a>03428         $results = array();
<a name="l03429"></a>03429         
<a name="l03430"></a>03430         $this-&gt;<a class="code" href="classCassandraDataIterator.html#a768a5fdcefd168820cf2ce498d4b2215">rewind</a>();
<a name="l03431"></a>03431         
<a name="l03432"></a>03432         <span class="keywordflow">while</span> ($this-&gt;<a class="code" href="classCassandraDataIterator.html#a5378a5276e6095d7e199ddb493d24ad8">valid</a>()) {
<a name="l03433"></a>03433             $key = $this-&gt;<a class="code" href="classCassandraDataIterator.html#a4cbe7dbf861e1deffaf14ae5cf2e4696">key</a>();
<a name="l03434"></a>03434             $value = $this-&gt;<a class="code" href="classCassandraDataIterator.html#a4543482c99d8a586477214766783978b">current</a>();
<a name="l03435"></a>03435             
<a name="l03436"></a>03436             $results[$key] = $value;
<a name="l03437"></a>03437             
<a name="l03438"></a>03438             $this-&gt;<a class="code" href="classCassandraDataIterator.html#a33a1d60da9dd9e9d610f2720558914d3">next</a>();
<a name="l03439"></a>03439         }
<a name="l03440"></a>03440         
<a name="l03441"></a>03441         <span class="keywordflow">return</span> $results;
<a name="l03442"></a>03442     }
<a name="l03443"></a>03443     
<a name="l03449"></a>03449     <span class="keyword">abstract</span> <span class="keyword">protected</span> function <a class="code" href="classCassandraDataIterator.html#a20435cd4a3a06df86d62f9975933c808">updateBuffer</a>();
<a name="l03450"></a>03450 }
<a name="l03451"></a>03451 
<a name="l03455"></a><a class="code" href="classCassandraIndexedDataIterator.html">03455</a> <span class="keyword">class </span><a class="code" href="classCassandraIndexedDataIterator.html">CassandraIndexedDataIterator</a> <span class="keyword">extends</span> <a class="code" href="classCassandraDataIterator.html">CassandraDataIterator</a> {
<a name="l03456"></a>03456     
<a name="l03462"></a>03462     <span class="keyword">protected</span> $indexClause;
<a name="l03463"></a>03463 
<a name="l03476"></a><a class="code" href="classCassandraIndexedDataIterator.html#a489fdf163525dd1bd4cf99b4e81708f3">03476</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraIndexedDataIterator.html#a489fdf163525dd1bd4cf99b4e81708f3">__construct</a>(
<a name="l03477"></a>03477         <a class="code" href="classCassandraColumnFamily.html">CassandraColumnFamily</a> $columnFamily,
<a name="l03478"></a>03478         cassandra_ColumnParent $columnParent,
<a name="l03479"></a>03479         cassandra_IndexClause $indexClause,
<a name="l03480"></a>03480         cassandra_SlicePredicate $slicePredicate,
<a name="l03481"></a>03481         $consistency,
<a name="l03482"></a>03482         $rowCountLimit,
<a name="l03483"></a>03483         $bufferSize
<a name="l03484"></a>03484     ) {
<a name="l03485"></a>03485         <a class="code" href="classCassandraIndexedDataIterator.html#a489fdf163525dd1bd4cf99b4e81708f3">parent::__construct</a>(
<a name="l03486"></a>03486             $columnFamily,
<a name="l03487"></a>03487             $columnParent,
<a name="l03488"></a>03488             $slicePredicate,
<a name="l03489"></a>03489             $indexClause-&gt;start_key,
<a name="l03490"></a>03490             $consistency,
<a name="l03491"></a>03491             $rowCountLimit, 
<a name="l03492"></a>03492             $bufferSize
<a name="l03493"></a>03493         );
<a name="l03494"></a>03494         
<a name="l03495"></a>03495         $this-&gt;indexClause = $indexClause;
<a name="l03496"></a>03496     }
<a name="l03497"></a>03497     
<a name="l03503"></a><a class="code" href="classCassandraIndexedDataIterator.html#a1d38641286c86458941bca203d6fea65">03503</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandraIndexedDataIterator.html#a1d38641286c86458941bca203d6fea65">updateBuffer</a>() {
<a name="l03504"></a>03504         <span class="keywordflow">if</span> ($this-&gt;rowCountLimit !== null) {
<a name="l03505"></a>03505             $this-&gt;indexClause-&gt;count = min(
<a name="l03506"></a>03506                 $this-&gt;rowCountLimit - $this-&gt;rowsSeen + 1,
<a name="l03507"></a>03507                 $this-&gt;bufferSize
<a name="l03508"></a>03508             );
<a name="l03509"></a>03509         } <span class="keywordflow">else</span> {
<a name="l03510"></a>03510             $this-&gt;indexClause-&gt;count = $this-&gt;bufferSize;
<a name="l03511"></a>03511         }
<a name="l03512"></a>03512         
<a name="l03513"></a>03513         $this-&gt;expectedPageSize = $this-&gt;indexClause-&gt;count;
<a name="l03514"></a>03514         $this-&gt;indexClause-&gt;start_key = $this-&gt;nextStartKey;
<a name="l03515"></a>03515         
<a name="l03516"></a>03516         $result = $this-&gt;columnFamily-&gt;getCassandra()-&gt;call(
<a name="l03517"></a>03517             <span class="stringliteral">&#39;get_indexed_slices&#39;</span>,
<a name="l03518"></a>03518             $this-&gt;columnParent,
<a name="l03519"></a>03519             $this-&gt;indexClause,
<a name="l03520"></a>03520             $this-&gt;slicePredicate,
<a name="l03521"></a>03521             $this-&gt;consistency
<a name="l03522"></a>03522         );
<a name="l03523"></a>03523         
<a name="l03524"></a>03524         <span class="keywordflow">if</span> (count($result) == 0) {
<a name="l03525"></a>03525             $this-&gt;buffer = array();
<a name="l03526"></a>03526         } <span class="keywordflow">else</span> {
<a name="l03527"></a>03527             $this-&gt;buffer = $this-&gt;columnFamily-&gt;parseSlicesResponse($result);
<a name="l03528"></a>03528         }
<a name="l03529"></a>03529         
<a name="l03530"></a>03530         $this-&gt;currentPageSize = count($this-&gt;buffer);
<a name="l03531"></a>03531     }
<a name="l03532"></a>03532 }
<a name="l03533"></a>03533 
<a name="l03537"></a><a class="code" href="classCassandraRangeDataIterator.html">03537</a> <span class="keyword">class </span><a class="code" href="classCassandraRangeDataIterator.html">CassandraRangeDataIterator</a> <span class="keyword">extends</span> <a class="code" href="classCassandraDataIterator.html">CassandraDataIterator</a> {
<a name="l03538"></a>03538     
<a name="l03544"></a>03544     <span class="keyword">protected</span> $startKey;
<a name="l03545"></a>03545     
<a name="l03551"></a>03551     <span class="keyword">protected</span> $endKey;
<a name="l03552"></a>03552 
<a name="l03565"></a><a class="code" href="classCassandraRangeDataIterator.html#a89ad9afec67135eed73321396c6581b1">03565</a>     <span class="keyword">public</span> function <a class="code" href="classCassandraRangeDataIterator.html#a89ad9afec67135eed73321396c6581b1">__construct</a>(
<a name="l03566"></a>03566         <a class="code" href="classCassandraColumnFamily.html">CassandraColumnFamily</a> $columnFamily,
<a name="l03567"></a>03567         cassandra_ColumnParent $columnParent,
<a name="l03568"></a>03568         cassandra_SlicePredicate $slicePredicate,
<a name="l03569"></a>03569         $startKey,
<a name="l03570"></a>03570         $endKey,
<a name="l03571"></a>03571         $consistency,
<a name="l03572"></a>03572         $rowCountLimit,
<a name="l03573"></a>03573         $bufferSize
<a name="l03574"></a>03574     ) {
<a name="l03575"></a>03575         <a class="code" href="classCassandraRangeDataIterator.html#a89ad9afec67135eed73321396c6581b1">parent::__construct</a>(
<a name="l03576"></a>03576             $columnFamily,
<a name="l03577"></a>03577             $columnParent,
<a name="l03578"></a>03578             $slicePredicate,
<a name="l03579"></a>03579             $startKey,
<a name="l03580"></a>03580             $consistency,
<a name="l03581"></a>03581             $rowCountLimit, 
<a name="l03582"></a>03582             $bufferSize
<a name="l03583"></a>03583         );
<a name="l03584"></a>03584         
<a name="l03585"></a>03585         $this-&gt;startKey = $startKey;
<a name="l03586"></a>03586         $this-&gt;endKey = $endKey;
<a name="l03587"></a>03587     }
<a name="l03588"></a>03588     
<a name="l03594"></a><a class="code" href="classCassandraRangeDataIterator.html#a743234ebb424200a5c3d7473ce95dbba">03594</a>     <span class="keyword">protected</span> function <a class="code" href="classCassandraRangeDataIterator.html#a743234ebb424200a5c3d7473ce95dbba">updateBuffer</a>() {
<a name="l03595"></a>03595         $bufferSize = $this-&gt;bufferSize;
<a name="l03596"></a>03596         
<a name="l03597"></a>03597         <span class="keywordflow">if</span> ($this-&gt;rowCountLimit !== null) {
<a name="l03598"></a>03598             $bufferSize = min(
<a name="l03599"></a>03599                 $this-&gt;rowCountLimit - $this-&gt;rowsSeen + 1,
<a name="l03600"></a>03600                 $this-&gt;bufferSize
<a name="l03601"></a>03601             );
<a name="l03602"></a>03602         }
<a name="l03603"></a>03603         
<a name="l03604"></a>03604         $this-&gt;expectedPageSize = $bufferSize;
<a name="l03605"></a>03605         
<a name="l03606"></a>03606         $keyRange = <span class="keyword">new</span> cassandra_KeyRange();
<a name="l03607"></a>03607         $keyRange-&gt;start_key = $this-&gt;nextStartKey;
<a name="l03608"></a>03608         $keyRange-&gt;end_key = $this-&gt;endKey;
<a name="l03609"></a>03609         $keyRange-&gt;count = $bufferSize;
<a name="l03610"></a>03610         
<a name="l03611"></a>03611         $result = $this-&gt;columnFamily-&gt;getCassandra()-&gt;call(
<a name="l03612"></a>03612             <span class="stringliteral">&#39;get_range_slices&#39;</span>,
<a name="l03613"></a>03613             $this-&gt;columnParent,
<a name="l03614"></a>03614             $this-&gt;slicePredicate,
<a name="l03615"></a>03615             $keyRange,
<a name="l03616"></a>03616             $this-&gt;consistency
<a name="l03617"></a>03617         );
<a name="l03618"></a>03618         
<a name="l03619"></a>03619         $this-&gt;buffer = $this-&gt;columnFamily-&gt;parseSlicesResponse($result);
<a name="l03620"></a>03620         $this-&gt;currentPageSize = count($this-&gt;buffer);
<a name="l03621"></a>03621     }
<a name="l03622"></a>03622 }
<a name="l03623"></a>03623 
<a name="l03627"></a><a class="code" href="classCassandraMaxRetriesException.html">03627</a> <span class="keyword">class </span><a class="code" href="classCassandraMaxRetriesException.html">CassandraMaxRetriesException</a> <span class="keyword">extends</span> Exception {};
<a name="l03628"></a>03628 
<a name="l03633"></a><a class="code" href="classCassandraConnectionClosedException.html">03633</a> <span class="keyword">class </span><a class="code" href="classCassandraConnectionClosedException.html">CassandraConnectionClosedException</a> <span class="keyword">extends</span> Exception {};
<a name="l03634"></a>03634 
<a name="l03638"></a><a class="code" href="classCassandraConnectionFailedException.html">03638</a> <span class="keyword">class </span><a class="code" href="classCassandraConnectionFailedException.html">CassandraConnectionFailedException</a> <span class="keyword">extends</span> Exception {};
<a name="l03639"></a>03639 
<a name="l03643"></a><a class="code" href="classCassandraSettingKeyspaceFailedException.html">03643</a> <span class="keyword">class </span><a class="code" href="classCassandraSettingKeyspaceFailedException.html">CassandraSettingKeyspaceFailedException</a> <span class="keyword">extends</span> Exception {};
<a name="l03644"></a>03644 
<a name="l03648"></a><a class="code" href="classCassandraColumnFamilyNotFoundException.html">03648</a> <span class="keyword">class </span><a class="code" href="classCassandraColumnFamilyNotFoundException.html">CassandraColumnFamilyNotFoundException</a> <span class="keyword">extends</span> Exception {};
<a name="l03649"></a>03649 
<a name="l03653"></a><a class="code" href="classCassandraInvalidRequestException.html">03653</a> <span class="keyword">class </span><a class="code" href="classCassandraInvalidRequestException.html">CassandraInvalidRequestException</a> <span class="keyword">extends</span> Exception {};
<a name="l03654"></a>03654 
<a name="l03658"></a><a class="code" href="classCassandraInvalidPatternException.html">03658</a> <span class="keyword">class </span><a class="code" href="classCassandraInvalidPatternException.html">CassandraInvalidPatternException</a> <span class="keyword">extends</span> Exception {};
<a name="l03659"></a>03659 
<a name="l03663"></a><a class="code" href="classCassandraUnsupportedException.html">03663</a> <span class="keyword">class </span><a class="code" href="classCassandraUnsupportedException.html">CassandraUnsupportedException</a> <span class="keyword">extends</span> Exception {};
</pre></div></div>
</div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Mon Jul 4 2011 14:35:59 for Cassandra PHP Client Library by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
